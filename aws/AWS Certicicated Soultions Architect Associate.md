# AWS Certificated Solutions Architect Associate

**AWS 자격증 Udemy 강의 요약** 



# Section 04. IAM

### IAM Section 

- IAM: Idenitity and Access Management => 글로벌 서비스
- 루트 계정
  - 기본으로 생성
  - 오직 계정을 생성할 때만 사용되어야 하며, 그 후에는 루트 계정을 더 이상 사용해서도, 공유해서도 안됨
- 사용자 생성
  - 하나의 사용자는 조직 내의 한 사람에 해당
  - 필요하다면 사용자들을 그룹으로 묶을 수 있음
- 그룹
  - 그룹에는 사용자만 배치할 수 있으며, 다른 그룹을 포함시킬 순 없음
  - 하나의 사용자가 다수의 그룹에 속할 수도 있음
- IAM: Permission
  - 사용자 또는 그룹에게 정책, 또는 IAM이라고 불리는 JSON 문서를 지정할 수 있음
  - 이 정책들을 사용해 사용자들의 권한을 정의할 수 있게 됨
  - AWS에서는 모든 사용자에게 모든 권한을 허용하지 않음 => 보안 문제 및 비용 문제
  - 최소 권한의 원칙을 적용
    - 사용자가 꼭 필요로 하는 것 이상의 권한을 주지 않음



### IAM Policies

- IAM Pocicies Structure

  - 구성 요소

    - Version: 정책 언어 버전, 항상 '2012-10-17'이 포함
    - Id: 정책을 식별하는 ID (optional)
    - Statement: 한개 이상의 문장 (required)

  - Statement의 구성 요소

    - Sid: 문장 ID로 문장의 식별자 (optional)
    - 효과(Effect): 문장이 특정 API에 접근하는걸 허용할지 거부할지에 대한 내용 (Allow / Deny)
    - 원칙(Principal): 특정 정책이 적용될 사용자, 계정, 혹은 역할로 구성
    - 조치(Action): effect에 기반해 허용 및 거부되는 API 호출의 목록
    - 리소스(Resource): 적용될 action의 리소스 목록
    - 컨디션(Condition): statement가 언제 적용될지를 결정 (optional)

    ```json
    {
      "Version": "2012-10-17",
      "Id": "S3-Account-Permissions",
      "Statememt": [
        {
          "Sid": "1",
          "Effect": "Allow",
          "Pricipal": {
            "AWS": ["arn:aws:iam:123456789012:root"]
          },
          "Action": [
            "s3:GetObject",
            "s3:PutObject"
          ],
          "Resource": ["arn:aws:s3::mybucket/*"]
        }
      ]
    }
    ```



### IAM MFA

- Password Policy
  - Strong passwords = 계정의 보안을 높여줌
  - AWS password policy 세팅 방법
    - 비밀번호 최소 길이 설정
    - 특정 유형의 글자 사용 요구
    - IAM 사용자들의 비밀번호 변경 허용 및 금지
    - 일정 기간이 지나면 새 비밀번호 설정 요구
    - 사용자의 비밀번호 재사용을 막기
- MFA (Multi Factor Authentication)
  - 유저들은 AWS 계정에 접근할 수 있고 리소스들을 변경하고 삭제할 수도 있으므로 이 위험에서 계정을 보호해야함
  - MFA = password you know + security device you own
- AWS에서 MFA 장치 옵션
  - 가상 MFA 장치 (Virtual MFA device)
    - Google Authenticator (phone only)
    - Authy (multi- device)
    - 하나의 장치에서 여러 계정 및 사용자를 지원함
  - 범용 두 번째 인자 보안 키 (U2F - Universion 2nd Factor Security Key)
    - 물리적 장치
    - Yubico(AWS 제3자 회사) 의 YubiKey
    - 하나의 보안 키로 여러 루트 계정과 IAM 유저를 지원
  - 하드웨어 키 팝 MFA 장치 (Hardware Key Fob MFA Device)
    - 물리적 장치
    - Gemalto(AWS 제3자 회사)
  - 하드웨어 키 팝 MFA 장치 (미국 정부 AWS GovCloud 전용)
    - SurePassID(AWS 제3자 회사)



### AWS 엑세스 키, CLI 및 SDK

- 유저가 AWS에 접근하는 방법
  - AWS Management Console (protected by password + MFA)
  - AWS Command Line Interface (CLI): protected by access keys
  - AWS Software Developer Kit (SDK): for code -> protected by access keys
- 액세스 키 생성 방법
  - AWS Console을 사용해서 생성할 수 있음
  - 사용자들이 자신들의 액세스 키를 직접 관리
  - 액세스 키는 비밀번호와 마찬가지로 암호와 같음 
  - 액세스 키는 절대 공유 되면 안됨
  - Access Key ID ~= username
  - Secret Access Key ~= password
- AWS CLI
  - 명령줄 셀에서 명령어를 사용하여 AWS 서비스들과 상호작용할 수 있도록 해 주는 도구
  - 모든 명령어가 aws로 시작
  - CLI를 사용하면 AWS 서비스의 공용 API로 직접 액세스가 가능
  - CLI를 통해 리소스를 관리하는 스크립트 개발해 일부 작업을 자동화할 수 있음
- AWS SDK
  - 소프트웨어 개발 키트
  - 특정 언어로 된 라이브러리의 집합 => 프로그래밍 언어에 따라 개별 SDK가 존재
  - SDK를 사용하면 AWS 서비스의 공용 API로 직접 액세스가 가능
  - 터미널을 통한 접근이 아니라 코딩을 통해 애플리케이션 내에 심어두는 방식
  - 다양한 프로그래밍 언어 지원 (JavaScript, Python, PHP, .NET, Ruby, Java, Go, Node.js, C++)
  - 모바일 SDKs (Android, iOS, ...)
  - IoT Device SDKs (Embedded C, Ariduino, ...)
  - 예시: AWS CLI는 파이썬 AWS SDK로 구성 돼 있음



### AWS 클라우드쉘

- 특정 지역에서만 가능
- AWS 클라우드에서 무료로 사용 가능한 터미널같은 개념
- 장점
  - CLI를 사용할 때 API 호출을 반환 
    - --region 을 이용해 API 호출을 할 리전을 지정할 수도 있음
    - 클라우드쉘에서 기본 리전은 현재 로그인 된 리전
  - 전체 저장소가 있음
  - 구성이 가능
    - 글씨 크기, 테마 선택, 안전하게 붙여넣기 기능
    - 파일 업로드 및 다운로드 가능
    - 탭 구성 가능



### AWS 서비스에 대한 IAM Role

- AWS 서비스 몇 가지는 우리의 계정에서 실행해야 하며, 이를 위해서는 사용자와 마찬가지로 어떤 권한이 필요함
- IAM Role은 사용자와 같지만 실제 사람이 사용하도록 만들어진 것이 아니고 AWS 서비스에 의해 사용되도록 만들어짐



### IAM 보안 도구

- IAM 자격 증명 보고서(Credentials Report)
  - 계정 수준(account- level)에서 가능
  - 보고서는 계정에 있는 사용자와 다양한 자격 증명의 상태를 포함
- IAM 액세스 관리자(Access Adviser)
  - 사용자 수준(user-level)에서 가능
  - 사용자에게 부여된 서비스의 권한과 해당 서비스에 마지막으로 엑세스한 시간이 보임
  - 해당 도구를 사용하여 어떤 권한이 사용되지 않는지 볼 수 있고 따라서 사용자의 권한을 줄여 최소권한의 원칙을 지킬 수 있음



## Section 05. EC2 기초

### EC2 기초

- EC2(Elastic Compute Cloud): AWS에서 제공하는 서비스형 인프라스트럭처
- 포함하고 있는 서비스
  - 가상 머신 임대 (EC2) => EC2 인스턴스
  - 데이터를 가상 드라이브 또는 EBS 볼륨에 저장 (EBS)
  - 엘라스틱 로드 밸런서로 로드를 분산 (ELB)
  - 오토 스케일링 그룹을 통해 서비스를 확장(ASG)
- EC2의 사용법을 아는 것은 클라우드 작동 방식을 이해할 때 필수적
- EC2 사이징(Sizing) & 설정 옵션(configuration options)
  - Operating System (OS): Linux, Windows or Mac OS
  - CPU: 컴퓨티 성능과 코어의 양
  - RAM: 램덤 엑세스 메모리의 양
  - 용량 공간
    - 네트워크를 통해 연결할 스토리지 필요 여부 (EBS & EFS)
    - 하드웨어 (EC2 인스턴스 스토어)
  - 네트워크 카드: 속도가 빠른 카드, 어떤 종류의 공용 IP
  - 방화병 규칙: 보안 그룹
  - 부트스트랩 스크립트 (처음에 설정): EC2 사용자 데이터
- EC2 사용자 데이터
  - EC2 사용자 데이터 스크립트를 사용하여 인스턴스를 부트스트래핑할 수 있음
  - 부트스트래핑: 머신이 작동될 때 명령을 시작하는 것
  - 스크립트는 처음 시작할 때 한 번만 실행됨
  - EC2 사용자 데이터가 자동화하는 작업들
    - 업데이트
    - 소프트웨어 설치
    - 일반적인 파일들을 인터넷에서 다운로드
    - 우리가 생각하는 모든 것들
  - EC2 사용자 데이터 스크립트는 루트 계정에서 실행 => 모든 명령문은 sudo로 해야 함
- EC2 인스턴스를 재실행시, 사설 IP는 항상 같은 상태로 유지되지만 공용 IP는 변경될 수 있음



### EC2 인스턴스 유형 기본 사항

- EC2 인스턴스 유형 - 개요
  - https://aws.amazon.com/ec2/instance-types/
  - m5.2xlarge 의미
    - m: 인스턴스 클래스
    - 5: 인스턴스의 세대(generation)
    - 2xlarge: 인스턴스 클래스의 사이즈 => 크기가 클수록 더 높은 메모리와 CPU 개수를 가짐
- 범용 인스턴스
  - 웹 서버나 코드 저장소와 같은 다양한 작업에 적합
  - 컴퓨팅, 메모리, 네트워킹 간의 균형도 잘 맞음
  - t2.micro 도 범용 인스턴스
- 컴퓨팅 최적화 인스턴스
  - 컴퓨터 집약적인 작업에 최적화된 인스턴스
  - 사용 사례
    - 일부 데이터의 일괄 처리
    - 미디어 트랜스코딩 작업 시
    - 고성능 웹 서버가 필요할 때
    - 고성능 컴퓨팅이라는 HPC 작업을 할 때
    - 과학적 모델링 & 머신 러닝
    - 전용 게임 서버
  -  Computing을 나타내는 C로 시작하는 이름을 가지고 있음
- 메모리 최적화 인스턴스
  - 메모리에서 대규모 데이터셋을 처리하는 유형에 빠른 성능을 제공
  - 사용 사례
    - 고성능의 관계형 / 비관계형 데이터베이스
    - 분산 웹스케일 캐시 저장소
    - BI(business intelligence)에 최적화된 인 메모리 데이터베이스
    - 대규모 비정형 데이터의 실시간 처리를 실행하는 애플리케이션
  - 보통 Ram을 나타내는 R로 시작하는 이름을 가지고 있음 (X1 이나 대용량 메모리, Z1도 있음)
- 스토리지 최적화 인스턴스
  - 로컬 스토리지에서 대규모의 데이터셋에 엑세스할 때 적합한 인스턴스
  - 사용 사례
    - 고주파 온라인 트랜잭션 처리(OLTP) 시스템
    - 관계형 & NoSQL 데이터베이스
    - 메모리 데이터베이스의 캐시 (ex - Redis)
    - 데이터 웨어하우징 애플리케이션
    - 분산 파일 시스템
  - I, G, H1으로 시작하는 이름을 가지고 있음

- 인스턴스 정보 보는 사이트: https://www.ec2instances.info/



### 보안 그룹 및 클래식 포트 개요

- 보안 그룹 개요
  - 보안 그룹은 AWS 클라우드에서 네트워크 보안을 실행하는데 핵심이 됨
  - EC2 인스턴스에 들어오고 나가는 트래픽을 제어
  - 보안 그룹은 오직 허용 규칙만 포함함
  - 보안 그룹 또는 IP 주소를 참조해 규칙을 만들 수 있음

- 보안 그룹 딥 다이브
  - 보안 그룹은 EC2 인스턴스의 방화벽
  - 규제 목록
    - 포트로의 엑세스 통제
    - 인증된 IP 주소의 범위를 확인해 IPv4인지 IPv6인지 확인
    - 외부에서 인스턴스로 들어오는 인바운드 네트워크 통제
    - 인스턴스에서 외부로 나가는 아웃바운드 네트워크 통제
  - 타입, 프로토콜, 포트 범위, 소스, 설명으로 구성
- 보안 그룹에 대해 알아야 하는 것 
  - 여러 인스턴스에 연결할 수 있음 => 보안 그룹과 인스턴스 간의 일대일 관계는 없음
  - 보안 그룹은 지역과 VPC 결합으로 통제되어 있음
  - 보안 그룹은 EC2 외부에 있음 => 트래픽이 차단되면 EC2 인스턴스는 확인할 수 없음
  - SSH 액세스를 위해 하나의 별도 보안 그룹을 유지하는 것이 좋음
  - 타임아웃으로 애플리케이션에 접근할 수 없으면 보안 그룹의 문제
  - 어떤 포트에 연결을 시도하는데 컴퓨터가 계속 멈추고 대기하기만 한다면 보안 그룹의 문제
  - ''연결 거부'' 오류가 발생하면 보안 그룹은 실행됐고 트래픽은 통과했지만 애플리케이션에 문제가 생겼거나 실행되지 않은 등 문제가 발생한 것
  - 기본적으로 모든 인바운드 트래픽은 차단되어 있고, 모든 아웃바운드 트래픽은 허용되어 있음
- 알아야 하는 포트
  - 22번 포트 => SSH(Secure Shell): Linux에서 EC2 인스턴스로 로그인하도록 함
  - 21번 포트 => FPT(File Transfer Protocol): 파일 공유 시스템에 파일을 업로드하는데 사용
  - 22번 포트 => SFTP (Secure FIle Transfer Protocol): SSH를 통해서 전송되고 보안 파일 전송 프로토콜이 되기 때문에 22번 포트를 사용함
  - 80번 포트 => HTTP: 보안이 되지 않은 사이트에 액세스하기 위함
  - 443번 포트 => HTTPS: 보안이 된 사이트에 엑세스하기 위함
  - 3389 포트 => RDP (Remote Desktop Protocol): 윈도우 인스턴스에 로그인할 때 사용



###   SSH 개요

- Secure Shell(SSH): 터미널이나 명령줄을 이용해서 원격 머신이나 서버를 제어할 수 있게 해줌
- SSH: Linux, Windows 10+
- PuTTY: Windows
- EC2 Instance Connect: Linux, Windows



### EC2 Instance Connect

- AWS EC2에서 실행
- 브라우저 기반으로  EC2 인스턴스에 대한  SSH 세션을 실행할 수 있음
- 임시 SSH키를 대신 업로드하고 접속을 하기 때문에 SSH 키를 따로 관리할 필요가 없음
- Amazone Linux AMI는 AWS CLI를 포함하고 있음 



### EC2 인스턴스 시작

- EC2 인스턴스에 엑세스 키  ID와 비밀 엑세스키를 입력하면 절대 안됨 => EC2 인스턴스 역할에서 IAM 역할을 사용하기

- EC2 인스턴스 구매 옵션

  - 온-디멘드 인스턴스 (On-Demand Instances)
    - 단기적 워크로드
    - 비용 예측 가능
    - 초 단위의 요금 지불
  - 예약 (Reserved) (1 & 3 년)
    - 예약 인스턴스: 장기적 워크로드
    - 전환형 예약 인스턴스: 유연한 인스턴스 타입
  - 절약 플랜 (Saving Plans) (1 & 3년)
    - 특정한 인스턴스 유형을 약정하는 게 아니라 달러 단위로 특정한 사용량을 약정
    - 장기적 워크로드

  - 스폿 인스턴스 (Spot Instances)
    - 단기적 워크로드
    - 매우 저렴
    - 언제라도 인스턴스들이 손실될 수 있어서 낮은 신뢰성을 가짐
  - 전용 호스트 (Dedicated Hosts)
    - 물리적 서버 전체를 예약해서 인스턴스 배치를 제어할 수 있음
  - 전용 인스턴스 (Dedicated Instances)
    - 다른 고객들이 자신의 하드웨어를 공유하지 않음
  - 용량 예약 (Capacity Reservations)
    - 원하는 기간 동안에 특정한  AZ(Availabilty Zone: 가용성 영역)에 용량을 예약할 수 있음

- EC2 On Demand

  - Linux나  Window 사용시: 1분 이후에 초 단위로 청구
  - 다른 모든 운영체계: 1시간 단위로 청구
  - 비용이 가장 많이 들지만 바로 지불한 금액은 없음
  - 장기적인 약정도 필요 없음
  - 단기적이고 중단 없는 워크로드가 필요할 때, 또는 애플리케이션의 거동을 예측할 수 없을 사용

- EC2 Reserved Instances (예약 인스턴스)

  - 예약 인스턴스는 온디맨드에 비해 최대 72%까지 할인을 제공
  - 특정한 인스턴스 속성을 예약 (인스턴스 타입, 리전, 테넌시, OS)
  - 예약 기간을 1년(+discount) 이나 3년(+++discount) 으로 지정해서 할인을 더 받을 수 있음
  - 결제 옵션: 모두 선결제(+++discount)  / 부분 선결제(++discount) / 선결제 없음(+discount)
  - 범위를 특정한 리전이나 존으로 할 수 있음 (특정한 AZ에 있는 예약된 용량)
  - 사용량이 일정한 애플리케이션에 예약 인스턴스를 사용하는게 좋음 (ex - database)
  - 예약 인스턴스를 마켓플레이스에서 살 수 있고, 더 이상 필요가 없어지면 팔 수도 있음
  - 전환형 예약 인스턴스 (Convertible Reserved Instance)
    - 인스턴스 타입, 인스터스 패밀리, 운영체계, 범위, 테넌시를 변경할 수 있음
    - 최대 66%까지 할인을 제공

- EC2 Saving Plans

  - 장기간 사용하면 할인을 받을 수 있음 (최대 72% - RI와 같음)
  - 다음 1년 내지 3년 동안 시간당 10달러로 약정을 하게 됨
  - 사용량이 한도를 넘어서면 절약 플랜은 온디맨드 가격으로 청구를 하게 됨
  - 특정한 인스턴스와 패밀리, 리전으로 고정됨
  - 유연한 속성
    - 인스턴스 사이즈
    - OS
    - 테넌시 (호스트, 전용, 기본)

- EC2 Spot Instances

  - 최대 90프로까지 할인
  - 스폿 인스턴스에 대해 지불하려는 최대 가격을 정의하고 만일 스폿 가격이 그 가격을 넘게 되면 인스턴스가 손실됨
  - AWS에서 가장 비용효율적인 인스턴스

  - 고장에 대한 회복력이 있는 워크로드에 유용
    - 배치 작업
    - 데이터 분석
    - 이미지 처리
    - 모든 종류의 분산형 워크로드
    - 시작 시간과 종료 시간이 유연한 워크로드
  - **아주 중요한 작업이나 데이터베이스에는 적절하지 않음**

- EC2 Dedicated Hosts

  - 활용 사례에 전용으로 사용되는 EC2 인스턴스 용량이 있는 실제 물리적 서버를 받게 됨
  - 물리적 서버 자체에 대한 접근권을 갖고 낮은 수준의 하드웨어에 대한 가시성을 제공해 줌
  - 기존의 서버에 연결된 소프트웨어 라이선스가 있는 경우 (법규 준수 요건이 있는 활용 사례나 소켓, 코어, VM 소프트웨어 라이센스)

  - 구매 옵션
    - 온-디멘드: 초당 비용 지불
    - 예약: 1 or 3년 (선결제, 부분결제, 후결제)
  - 가장 비싼 옵션 => 실제로 물리적 서버를 예약하기 때문
  - 활용 사례
    - 라이선싱 모델과 함께 사용되는 소프트웨어 (BYOL - Bring Your Own License)
    - 규정이나 법규를 반드시 준수해야 하는 회사

- EC2 Dedicated Instances

  - 전용 하드웨어에서 실행되는 인스턴스
  - 자신만의 인스턴스를 자신만의 하드웨어에 가짐
  - 같은 계정에서 다른 인스턴스와 함께 하드웨어를 공유할 수 있음
  - 인스턴스 배치에 대한 통제권이 없음

- EC2 Capacity Reservations

  - 원하는 기간 동안 특정한  AZ에서 온디맨드 인스턴스를 예약할 수 있음
  - 필요할 때마다 예약한 용량에 접근 가능
  - 기간 약정은 없음 (언제든 예약, 취소 가능)
  - 청구 할인도 없음
  - 지역별 예약 인스턴스와 결합하거나 절약 플랜과 결합해서 요금 할인 가능
  - 인스턴스를 실행하는지에 무관하게 온디맨드 요금이 부과됨
  - 특정한 AZ에 있어야 하는 단기적이고 중단 없는 워크로드에 아주 적합



### 스팟 인스턴스 및 스팟 집합

- 최대 스팟 가격을 정의하고, 인스턴스의 현재 스팟 가격이 정의한 최대 스팟 가격을 넘지 않으면 실행됨
  - 시간당 스팟 가격은 오퍼와 용량에 따라 달라짐
  - 현재 스팟 가격이 최대 스팟 가격을 초과하면 2가지 옵션이 있으며 2분의 유예 기간을 줌
    - 인스턴스 중지: 어느 날 스팟 가격이 최대 가격 아래로 내려가면 인스턴스를 다시 시작하고 중단했던 곳부터 재개
    - 인스턴스 종료: 인스턴스 상태가 필요하지 않다면 종료 후 작업을 다시 시작할 때 새로운 EC2 인스턴스로 시작
- 스팟 블록 (Spot Block)
  - 지정된 기간 동안 스팟 인스턴스를 차단
  - 1~6시간까지 가능하며, 그동안 중단 없이 해당 블록을 사용할 수 있음
  - 하지만 아주 드물게 인스턴스가 회수되는 경우가 있음
  - 현재 AWS에서 지원을 하지 않으나 가끔 시험에 나옴
- 스팟 인스턴스 종료법
  - 스팟 요청 유형은 일회성 인스턴스 요청과 영구 인스턴스 요청으로 나뉨
    - 일회성 인스턴스 요청은 한 번의 스팟 요청으로 끝남
    - 영구 인스턴스 요청은 인스턴스가 어떤 이유로든 중지되는 경우 스팟 요청이 다시 실행되고, 유효성이 확인되면, 스팟 인스턴스가 다시 시작됨
  - 따라서 영구 인스턴스 요청 유형의 스팟 요청을 가지는 스팟 인스턴스를 종료하려면 스팟 요청을 먼저 취소해야함
- 스팟 플릿 (Spot Fleets)
  - 스팟 플릿 = 스팟 인스턴스 세트 + (optional) 온디맨드 인스턴스 세트
  - 사용자가 정의한 가격 제한으로 목표 용량을 충족하기 위해 최선을 다함
    - 가능한 런치 풀에서 시작: 다양한 인스턴스 유형, 다양한  OS 및 다양한 가용성 영역을 가질 수 있음
    - 다양한 런치 풀을 정의하게 되고, 플릿이 가장 적합한 런치 풀을 선택함
    - 스팟 플릿이 예산에 도달하거나 원하는 용량에 도달하면 인스턴스 시작을 중지함
  - **스팟 플릿에 스팟 인스턴스를 할당하는 전략**
    - 최저 가격 (lowestPrice): 가장 낮은 가격인 풀에서 인스턴스를 시작 (비용이 최적화, 매우 짧은 워크로드)
    - 다양한 방법 (diversified): 사용자가 정의한 모든 풀에 분산됨 (가용성에 좋음 => 한 풀이 사라져도 다른 풀은 여전히 활성화 돼 있으므로, 긴 워크로드)
    - 용량 최적화 (capacityOptimized): 원하는 인스턴스 수에 맞는 최적의 용량을 가진 풀을 가짐
    - 가격 용량 최적화 (priceCapacityOptimized): 먼저 사용 가능한 용량이 가장 큰 풀을 선택하고 그 중 가격이 가장 낮은 풀을 선택하는 전략 (recommended, 대부분의 워크로드에 가장 적합)
  - 스팟 플릿을 사용하면 여러 개의 런치 풀과 여러 인스턴스 유형을 정의할 수 있고 가장 낮은 가격으로 자동으로 스팟 인스턴스를 요청함



## Section 06. EC2 - 솔루션스 아키텍트 어소시에이트 레벨

### 프라이빗 vs 퍼블릭 vs 탄력적 IP

- private vs public IP (IPv4)
  - IPv4 vs IPv6
    - IPv4: 1.160.10.240
    - IPv6: 3ffe:1900:4545:3:200:f8ff:fe21:67cf
  - 강의에선 IPv4만 사용할 것이지만 AWS는 IPv6도 지원함
  - IPv4는 현재 온라인에서 가장 널리 사용되는 형식
  - IPv6는 많은 문제를 해결해주며, IoT(사물 인터넷)에 더 많이 쓰임
  - IPv4는 공용 공간에서 37억 개의 서로 다른 주소를 허용 => 이제  IP 주소가 거의 고갈되어 가고 있음
  - IPv4: [0-255].[0-255].[0-255].[0-255].
  - Private vs Public IP
    - 공용  IP
      - 인터넷 전역에 액세스할 수 있음
      - 기기가 인터넷상에서 식별될 수 있음
      - 각 공용  IP는 전체 웹에서 유일함
      - IP의 지리적 위치를 쉽게 찾을 수 있음
    - 사설  IP
      - 사설 네트워크 내에서만 액세스할 수 있음
      - 기기가 오직 사설 네트워크 안에서만 식별될 수 있음
      - IP가 사설 네트워크 안에서만 유일하면 됨
      - 두 개의 다른 사설 네트워크는 같은 사설  IP를 가질 수 있음
      - 기기가 사설 네트워크에 있을 때 NAT 장치와 프록시 역할을 할 인터넷 게이트웨이를 통해 인터넷에 연결됨
      - 지정된 범위의  IP만 사설  IP로 사용될 수 있음
- Elastic IPs (탄력적  IP)
  - EC2 인스턴스를 시작하고 중지할 때 공용 IP를 바꿀 수 있음
  - 인스턴스에 고정된 공용 IP를 사용하면 탄력적 IP가 필요하게 됨
  - 탄력적  IP는 공용 IPv4인데 삭제하지 않는 한 계속 가지고 있게 됨
  - 한 번에 한 인스턴스에만 첨부할 수 있음
  - IP 주소가 탄력적이면 한 인스턴스에서 다른 인스턴스로 빠르게 이동함으로써 인스턴스 또는 소프트웨어의 오류를 마스킹할 때 사용할 수 있음 (드문 경우)
  - 계정당 탄력적  IP를 5개만 쓸 수 있음 (AWS에 개수 증가를 요청할 수 있음)
  - 결론적으로, 탄력적 IP는 사용하지 않는 것이 좋음
    - 매우 좋지 않은 구조적 결정
    - 대신, 임의의 공용 IP를 써서  DNS 이름을 할당하는 것이 좋음
- AWS EC2
  - 기본값으로  EC2 기기는 내부 AWS 네트워크엔 사설 IP, www(world wide web)엔 공용 IP를 사용
  - EC2 머신에 SSH를 사용할 때
    - 사설  IP를 사용할 수 없음 => 같은 네트워크에 있지 않으므로
    - 공용 IP만 사용할 수 있음
  - **기기가 멈췄다가 다시 시작하면 공용  IP가 바뀔 수 있음**



### EC2 배치 그룹 (Placement Groups)

- EC2 인스턴스가  AWS 인프라에 배치되는 방식을 제어하고자 할 때 사용
- 배치 그룹을 사용하여 전략을 정의 가능
- 배치 그룹을 만들 때 세 가지 전략을 사용할 수 있음
  - 클러스터 (Cluster): 단일 가용 영역 내에서 지연 시간이 짧은 하드웨어 설정으로 인스턴스를 그룹화
  - 분산 (Spread): 인스턴스가 다른 하드웨어에 분산 (가용 영역별로 분산된 배치 그룹당 최대 7개의 인스턴스를 가질 수 있음) => 크리티컬 애플리케이션이 있는 경우
  - 분할 (Partition): 여러 파티션에 인스턴스가 분할되어 있고, 이 파티션은 가용 영역 내의 다양한 하드웨어 랙 세트에 의존. 그룹당 수백 개의 EC2 인스턴스를 통해 확장할 수 있고 이를 통해 Hadoop, Cassandra, Kafka 같은 애플리케이션을 실행할 수 있음
- Placement Groups Cluster
  - 모든 EC2 인스턴스가 동일한 랙(=동일한 하드웨어 및 가용 영역)에 있음
  - 장점: 매우 빠른 네트워크
  - 단점: 랙에 실패가 발생하면 모든 EC2 인스턴스가 동시에 실패함
  - 사용 사례
    - 빅데이터 작업
    - 극히 짧은 지연 시간과 높은 네트워크 처리량을 필요로 하는 애플리케이션이 있는 요청
- Placement Groups Spreds
  - 실패 위험을 최소화
  - 모든 EC2 인스턴스가 다른 하드웨어에 위치
  - 장점: 여러 가용 영역에 걸쳐 있을 수 있으며, 동시 실패의 위험이 감소
  - 단점: **배치 그룹의 가용 영역당 7개의 인스턴스로 제한이 됨**
  - 사용 사례
    - 가용성을 극대화하고 위험을 줄여야 하는 애플리케이션
    - 인스턴스 오류를 서로 격리해야하는 크리티컬 애플리케이션
- Placement Groups Partition
  - 가용 영역당 최대 7개의 파티션이 있을 수 있음
  - 이러한 파티션은 동일한 리전의 여러 가용 영역에 걸쳐 있을 수 있음
  - 설정으로 최대 수백 개 EC2 인스턴스를 얻을 수 있음
  - 인스턴스와 파티션은 다른 파티션의 인스턴스와 동일한 하드웨어 물리적 랙을 공유하지 않으므로 각 파티션은 실패로부터 격리됨
  - EC2 인스턴스가 어떤 파티션에 있는지 알기 위해 메타데이터 서비스를 사용하여 이 정보에 액세스하는 옵션이 있음
  -  사용 사례
    - 대규모의 분산 및 복제된 워크 로드
    - HDFS, HBase, Cassandra, Kafka



### ENI (탄력적 네트워크 인터페이스)

- Elastic Network Interfaces (ENI)
  - VPC의 논리적 구성 요소이며 가상 네트워크 카드를 나타냄
  - ENI는 EC2 인스턴스가 네트워크에 액세스할 수 있게 해줌
  - ENI는 EC2 인스턴스 외부에서도 사용됨
  - 속성
    - 주요 사설 IPv4와 하나 이상의 보조 IPv4를 가질 수 있음
    - 각 ENI는 사설 IPv4당 탄력적 IPv4를 갖거나 혹은 하나의 공용 IPv4를 가질 수 있음
    - ENI에 하나 이상의 보안 그룹을 연결할 수 있음
    - MAC 주소 및 기타 항목을 연결할 수 있음
  - EC2 인스턴스와 독립적으로 ENI를 생성하고 즉시 연결하거나 장애 조치를 위해  EC2 인스턴스에서 이동시킬 수 있음
  - 특정 가용 영역, 즉  AZ에 바인딩 됨



### EC2 절전(Hibernate) 모드

- 인스턴스 중지 방법
  - 중지 (Stop): 디스크 데이터(EBS)는 다시 시작할 때까지 그대로 유지
  - 종료 (Terminate)
    - 루트 볼륨이 삭제되게 했다면 인스턴스도 삭제
    - 그렇게 설정하지 않은 다른 볼륨은 인스턴스가 종료되더라도 그대로 남음
- 인스턴스 다시 시작시 발생하는 일
  - 첫 시작: OS가 먼저 부팅되기 시작하고 EC2 사용자 데이터 스크립트도 실행
  - 시작 후: 운영 체제가 부팅이 완료
  - 애플리케이션이 실행되고 캐시도 구성되므로 과정이 끝날 때까지 시간이 다소 걸림
- EC2 절전 모드
  - EC2 절전 모드 소개
    - 인 메모리(RAM) 상태는 그대로 보존
    - 인스턴스 부팅이 더 빨라짐 (OS를 완전히 중지하거나 재시작하지 않았으므로)
    - 백그라운드: RAM에 기록되었던 인 메모리 상태는 루트 경로의 EBS 볼륨에 기록됨
    - 루트 EBS 볼륨을 암호화해야 하고 볼륨 용량도 RAM을 저장하기에 충분해야 함
  - 사용 사례
    - 오래 실행되는 프로세스를 갖고 있고 중지하지 않을 때
    - RAM 상태를 저장하고 싶을 때
    - 빠르게 재부팅을 하고 싶을 때





## Section 07. EC2 인스턴스 스토리지

### EBS 개요

- EBS Volume?
  - EBS (Elastic Block Store) Volume: 인스턴스가 실행 중인 동안 연결 가능한 네트워크 드라이브
  - EBS 볼륨을 사용하면 인스턴스가 종료된 후에도 데이터를 지속할 수 있음
  - CCP 레벨: 하나의 EBS는 하나의 EC2 인스턴스에만 마운트 가능(단, 여러개의 EBS가 하나의 EC2 인스턴스에도 마운트가 가능함)
  - 어소시에이트 레벨: 일부 EBS 다중 연결
  - EBS 볼륨을 생성할 때는 특정 가용 영역에서만 가능
  - 네트워크 USB 스틱과 같은 역할
  - Free tier: 매달 30GB의 EBS 스토리지를 범용 SSD 혹은 마그네틱 유형으로 제공
- 특징
  - 네트워크 드라이브 => 물리적 드라이브가 아님
    - 인스턴스와 EBS 볼륨이 서로 통신을 하기 위해서는 네트워크를 필요로 함 => 따라서 컴퓨터가 다른 서버에 도달할 때 지연이 발생할 수 있음
    - EC2 인스턴스에서 분리될 수 있고 매우 빠르게 다른 인스턴스로 연결될 수 있음
  - 특정한 가용 역역(AZ)에 고정되어 있음
    - 하지만 스냅샷을 이용하면 다른 가용 역역으로도 볼륨을 옮길 수 있음
  - 볼륨이기 때문에 용량을 미리 결정해야 함
    - 원하는 양의  GB 및 IOPS(단위 초당 전송 수)
    - 해당 프로비전 용량에 따라 요금이 청구됨
    - 더좋은 성능이나 큰 사이즈가 필요하면 이후에 용량을 늘릴 수도 있음 
- **EBS - 종료 시 삭제 속성**(Delete on Termination attribute)
  - 이 옵션을 통해 EC2 인스턴스 종료 시 EBS 행동을 제어할 수 있음
    - 루트 EBS 볼륨은 디폴트 값으로 인스턴스 종료와 함께 삭제되도록 설정이 되어 있음 (활성 상태)
    - 다른 EBS 볼륨은 디폴트 값으로 삭제되지 않도록 설정이 되어 있음 (비활성 상태)
  - 종료 시 삭제 활성화 여부는 원하는 대로 조작이 가능
  - 종료 시 삭제 속성 비활성 상태 사용 예시
    - 인스턴스가 종료될 때 루트 볼륨을 유지하고자 하는 경우
    - 데이터를 저장하고자 하는 경우



### EBS 스냅샷 개요

- EBS 스냅샷
  - EBS 볼륨의 특정 시점에 대한 백업
  - EC2 인스턴스에서 EBS 볼륨을 분리할 필요는 없지만 권장 사항임
  - EBS 스냅샷은 다른 가용 역역이나 다른 리전에도 복사할 수도 있음
- 기능
  - EBS 스냅샷 아카이브(EBS Snapshot Archive)
    - 최대 75%까지 저렴한 아카이브 티어로 스냅샷을 옮길 수 있는 기능
    - 스냅샷을 아카이브 티어로 옮기면 아카이브를 복원하는데 24시간에서 최대 72시간이 걸림
  - EBS 스냅샷 휴지통(Recycle Bin for EBS Snapshots)
    - EBS 스냅샷을 삭제하는 경우 영구 삭제하는 대신에 휴지통에 넣을 수 있음 (복원 가능)
    - 휴지통에 보관되는 기간은 1일에서 1년 사이로 설정할 수 있음
  - 빠른 스냅샷 복원(FSR - Fast Snapshot Restore) 
    - 스냅샷을 완전 초기화해 첫 사용에서의 지연 시간을 없애는 기능
    - 스냅샷이 아주 크고 EBS 볼륨 또는 EC2 인스턴스를 빠르게 초기화해야 할 때 특히 유용
    - 비용이 많이 드니 사용에 유의



### AMI 개요

- AMI
  - AMI(Amazon Machine Image): EC2 인스턴스를 통해 만든 이미지를 통칭
  - AMI로 EC2 인스턴스를 원하는 대로 변경 가능
    - 원하는 소프트웨어 또는 설정 파일, 별도의 운영 체제, 모니터링 툴을 추가 가능
    - AMI를 따로 구성하면 부팅 및 설정에 드는 시간을 줄일 수 있음 => 우리가  EC2 인스턴스에 설치하고자 하는 모든 소프트웨어를 AMI가 미리 패키징해주기 떄문
  - AMI는 특정 지역에 구축 (다른 지역으로 복사도 가능)
  - EC2 인스턴스를 여러 종류의  AMI에서 실행 가능
    - A Public AMI(전체 공개 AMI): AWS에서 제공
    - Your own AMI(자체적으로 구성한 AMI): 직접 만들고 유지, 관리도 직접 해야 함
    - An AWS Marketplace AMI: 다른 사람이 구축한 AMI (보통은 구매한 이미지)
- AMI Process (from an EC2 instance)
  - 먼저 EC2 인스턴스를 원하는 대로 설정
  - 인스턴스를 중지해 데이터 무결성을 확보
  - 이 인스턴스를 바탕으로 AMI를 구축 (이 과정에서 EBS 스냅샷이 생성됨)
  - 다른 AMI에서 인스턴스를 실행할 수 있음



### EC2 인스턴스 스토어

- EC2 인스턴스 스토어
  - EBS 볼륨은 네트워크 드라이브이기 때문에 뛰어나지만 제한된 성능을 가짐
  - 고성능의 하드웨어 디스크 성능이 필요하다면, EC2 인스턴스 스토어를 사용해야 함
  - I/O 성능 향상을 위해 활용할 수 있음
  - EC2 인스턴스 스토어를 중지 또는 종료하면 해당 스토리지 또한 손실됨 => 단기 스토리지 기능
  - 사용 예시: 버퍼 / 캐시 / 스크래치 데이터 / 임시 콘텐츠
  - EC2 인스턴스의 기본 서버에 장애가 발생할 시에는 해당 EC2 인스턴스가 연결된 하드웨어에도 장애가 발생하므로 데이터 손실에 대한 위험이 존재
  - 필요에 따라 데이터를 백업해 두거나 복제해 둬야 함



### EBS 볼륨 유형

- EBS 볼륨 유형 (6 types)

  - gp2 / gp3 (SSD)
    - 범용 SSD 볼륨 
    - 다양한 워크로드에 대해 가격과 성능의 절충안이 됨
  - io1 / io2 (SSD)
    - 최고 성능을 자랑하는 SSD 볼륨
    - 미션 크리티컬이자 지연 시간이 낮고 대용량의 워크로드에 쓰임
  - st1 (HDD)
    - 저비용의 HDD 볼륨
    - 잦은 접근과 처리량이 많은 워크로드에 쓰임
  - sc1 (HDD)
    - 가장 비용이 적게 드는 HDD 볼륨
    - 접근 빈도가 낮은 워크로드를 위해 설계됨

  - 크기, 처리량, IOPS 에 따라 EBS 볼륨 유형이 나뉨
  - gp2 / gp3와  io1 / io2 만이 부팅 볼륨으로 사용될 수 있음

- General Purpose SSD (gp2 / gp3)

  - 짧은 지연 시간, 효율적인 비용의 스토리지
  - 시스템 부팅 볼륨 및 가상 데스크톱, 개발, 테스크 환경에서 사용할 수 있음
  - 크기: 1GB ~ 16TB
  - gp3
    - 최신 세대의 볼륨
    - 기본 성능으로 3,000 IOPS와 125MB/s의 처리량을 제공
    - IOPS는 최대 16,000, 처리량은 최대 1,000MB/s까지 증가시킬 수 있음
  - gp2
    - 최대 3,000 IOPS
    - 볼륨과 IOPS가 연결되어 있으며,  최대  IOPS는 16,000
    - 1GB 당 3IOPS

- Provisioned IOPS (PIOPS) SSD (io1 / io2)

  - IOPS 성능을 유지할 필요가 있는 주요 비즈니스 애플리케이션
  - 16,000 IOPS 이상을 필요로 하는 애플리케이션
  - 일반적으로 데이터베이스 워크로드에 알맞음 (스토리지 성능과 일관성에 민감)
  - io1 / io2 (4GB ~ 16TB)
    - 최대 POIPS: **Nitro EC2 인스턴스에서 64,000 IOPS**  / 나머지는 32,000  IOPS
    - 프로비저닝된  IOPS의 스토리지 크기를 독자적으로 증가시킬 수 있음
    - io2는 io1과 동일한 비용으로 내구성과 기기 당  IOPS의 수가 더 높음 (2가 더 합리적)
  - io2 Block Express (4GB ~ 64TB)
    - 고성능 유형의 볼륨
    - 지연 시간이 밀리초 미만
    - IOPS 대 GB 비율이 1,000 : 1  일 때 최대 256,000 IOPS
  - EBS 다중 연결을 지원

- Hard Disk Drives (HDD) (st1 / sc1)

  - 부팅 볼륨이 될 수 없음
  - 125MB ~ 16TB
  - 처리량 최적화(Throuhput Optimized) HDD (st1)
    - 처리량 최적화 HDD
    - 빅 데이터나 데이터 웨어하우징 로그 처리에 적합
    - 최대 처리량은 초당 500MB, 최대 IOPS는 500
  - 콜드(Cold) HDD (sc1)
    - 아카이브 데이터용
    - 접근 빈도가 낮은 데이터에 적합
    - 최저 비용으로 데이터를 저장할 때 사용
    - 최대 처리량은 초당 250MB, 최대 IOPS는 250



### EBS 다중 연결

- EBS 다중 연결 - io1 / io2 제품군
  - 하나의 EBS 볼륨을 같은 가용 영역에 있는 여러 EC2 인스턴스에 연결할 수 있게 해 줌
  - 각 인스턴스는 고성능 볼륨에 대한 읽기 및 쓰기 권한을 전부 가짐 => 동시에 읽고 쓸 수 있음
  - 사용 사례
    - 애플리케이션 가용성을 높이기 위해 클러스터링된 Linux 애플리케이션 (ex: Teradata)
    - 애플리케이션이 동시 쓰기 작업을 관리해야 할 때
  - **한 번에 16개**의  EC2 인스턴스만 같은 볼륨에 연결 가능
  - 반드시 클러스터 인식 파일 시스템을 사용해야 함 (not XFS, EX4, etc)



### EBS 암호화

- EBS 암호화(Encryption)
  - EBS 볼륨을 생성하면 즉시 다음과 같은 일이 동시다발적으로 일어남
    - 저장 데이터가 볼륨 내부에 암호화
    - 인스턴스와 볼륨 간의 전송 데이터가 암호화
    - 모든 스냅샷이 암호화
    - 스냅샷으로 생성한 볼륨도 암호화
  - 암호화 및 복호화 메커니즘은 보이지 않게 처리 됨 (아무것도 할 필요가 없음)
  - 암호화는 지연 시간에는 영향이 거의 없음
  - KMS에서 암호화 키를 생성해 AES-256 암호화 표준을 가짐
  - 스냅샷을 복사해 함호화를 푼 걸 다시 암호화 활성화를 함
- EBS 볼륨 암호화 및 암호화 풀기
  - 볼륨의 EBS 스냅샷을 생성
  - 복사 기능을 통해 EBS 스냅샷을 암호화함
  - 스냅샷을 이용해 새 EBS 볼륨을 생성 (해당 볼륨 또한 암호화 됨)
  - 암호화된 볼륨을 인스턴스 원본에 연결



### Amazon EFS

- Amazon EFS - Elastic File System

  - 네트워크 파일 시스템: 많은  EC2 인스턴스에 마운트될 수 있음
  - EC2 인스턴스는 서로 다른 가용성 영역에 있을 수 있음
  - 가용성이 높고 확장성이 뛰어나며 비쌈 (gp2 EBS 볼륨의 약 3배)
  - 사용량에 따라 비용 지불
  - 사용사례: 콘텐츠 관리, 웹 서빙, 데이터 공유, Wordpress
  - 내부적으로 NFSv4.I protocol 을 사용
  - EFS에 대한 엑세스를 제어하려면 보안 그룹을 설정해야 함
  - **Linux 기반 AMI와만 호환됨 (윈도우 X)**
  - KMS를 사용해서 EFS 드라이브에서 미사용 암호화를 활성화 가능
  - POSIX 파일 시스템 (Linux 전용) 사용 => 표준 파일  API를 가짐
  - 파일 시스템은 자동으로 확장되며 EFS에서 사용하는 데이터 GB 사용량에 따라 비용을 지불

- EFS - 성능 클래스

  - EFS Scale
    - 수천 개의 동시 NFS 클라이언트, 10GB/s 이상의 처리량
    - PB(Petabyte) 규모의 네트워크 파일 시스템으로 자동 확장 가능

  - 성능 모드(Perfomance Mode) (EFS 생성 시에 설정 가능)
    - 범용 (기본값): 지연시간에 민감한 사용 사례에 사용 (웹 서버, CMS)
    - 최대 I/O: 지연시간이 길지만, 처리량이 높고 병렬성이 높음 (빅 데이터 애플리케이션, 미디어 처리)
  - 처리량 모드(Throughput Mode)
    - 버스팅(Bursting): 1TB = 50Mb/s + 100Mb/s 버스트
    - 프로비저닝(Provisioned): 스토리지 크기에 관계없이 처리량을 설정하고 싶은 경우 (ex: 1Gb/s for 1Tb 용량)
    - 엘라스틱(Elastic): 워크로드에 따라 처리량을 자동으로 조절
      - 읽기 최대  3Gb/s, 쓰기 최대 1Gb/s
      - 워크로드를 예측하기 어려울 때 유용

- EFS - 스토리지 클래스

  - 스토리지 티어(Storage Tiers): 며칠 후 파일을 다른 계층으로 옮길 수 있는 기능

    - Standard: 자주 액세스하는 파일
    - Infrequent access(EFS-IA)
      - 자주 엑세스 하지 않는 파일
      - 낮은 비용
      - 이 계층에서 파일을 검색할 경우 비용이 발생
      - 사용하려면 수명 주기 정책을 사용해야 함

  - 가용성과 내구성(Availability and durability)

    - Standard: 다중 AZ, 프로덕션 사용 사례에 적합 => 가용성 영역 하나가 다운되더라도 EFS 파일 시스템에 영향을 미치지 않으므로
    - One Zone(EFS One Zone-IA): 하나의 AZ, 개발용으로 적합, 백업이 기본적으로 활성화, 엑세스 빈도가 낮은 스토리지 계층과 호환되지 않음

  - 최대 90% 비용할인 가능

    

### EBS 대 EFS

- EBS(Elastic Block Storage)
  - EBS volumes
    - 하나의 인스턴스에만 첨부 (io1/io2의 다중 첨부 기능 제외)
    - AZ 수준에서 잠김
    - gp2: 디스크 크기가 증가하면 IO가 증가
    - Io1: 독립적으로 IO를 늘릴 수 있음
  - AZ 간에 EBS 볼륨 마이그레이션 방법
    - 스냅샷을 찍어야 함
    - 스냅샷을 다른 AZ로 복원
    - EBS 볼륨 백업은 IO를 사용하므로, 애플리케이션이 많은 트래픽을 처리하는 경우엔 실행하지 않아야 함 => EC2 성능에 영향을 미칠 수 있음
  - EBS 인스턴스의 루트 EBS 볼륨은 EC2 인스턴스가 종료되면 기본적으로 종료됨 (비활성화 가능)
- EFS(Elastic FIle System)
  - 여러 가용성 영역에 걸친 수백 개의 인스턴스에 첨부
  - 여러 인스턴스가 하나의 파일 시스템을 공유
  - WordPress와 같은 웹사이트 파일을 공유
  - Linux 전용 (POSIX 시스템)
  - EBS보다 가격대가 높음 
  - EFS-IA 기능을 활용하여 비용 절감 가능

