# AWS Certificated Solutions Architect Associate

**AWS 자격증 Udemy 강의 요약** 



# Section 04. IAM

### IAM Section 

- IAM: Idenitity and Access Management => 글로벌 서비스
- 루트 계정
  - 기본으로 생성
  - 오직 계정을 생성할 때만 사용되어야 하며, 그 후에는 루트 계정을 더 이상 사용해서도, 공유해서도 안됨
- 사용자 생성
  - 하나의 사용자는 조직 내의 한 사람에 해당
  - 필요하다면 사용자들을 그룹으로 묶을 수 있음
- 그룹
  - 그룹에는 사용자만 배치할 수 있으며, 다른 그룹을 포함시킬 순 없음
  - 하나의 사용자가 다수의 그룹에 속할 수도 있음
- IAM: Permission
  - 사용자 또는 그룹에게 정책, 또는 IAM이라고 불리는 JSON 문서를 지정할 수 있음
  - 이 정책들을 사용해 사용자들의 권한을 정의할 수 있게 됨
  - AWS에서는 모든 사용자에게 모든 권한을 허용하지 않음 => 보안 문제 및 비용 문제
  - 최소 권한의 원칙을 적용
    - 사용자가 꼭 필요로 하는 것 이상의 권한을 주지 않음



### IAM Policies

- IAM Pocicies Structure

  - 구성 요소

    - Version: 정책 언어 버전, 항상 '2012-10-17'이 포함
    - Id: 정책을 식별하는 ID (optional)
    - Statement: 한개 이상의 문장 (required)

  - Statement의 구성 요소

    - Sid: 문장 ID로 문장의 식별자 (optional)
    - 효과(Effect): 문장이 특정 API에 접근하는걸 허용할지 거부할지에 대한 내용 (Allow / Deny)
    - 원칙(Principal): 특정 정책이 적용될 사용자, 계정, 혹은 역할로 구성
    - 조치(Action): effect에 기반해 허용 및 거부되는 API 호출의 목록
    - 리소스(Resource): 적용될 action의 리소스 목록
    - 컨디션(Condition): statement가 언제 적용될지를 결정 (optional)

    ```json
    {
      "Version": "2012-10-17",
      "Id": "S3-Account-Permissions",
      "Statememt": [
        {
          "Sid": "1",
          "Effect": "Allow",
          "Pricipal": {
            "AWS": ["arn:aws:iam:123456789012:root"]
          },
          "Action": [
            "s3:GetObject",
            "s3:PutObject"
          ],
          "Resource": ["arn:aws:s3::mybucket/*"]
        }
      ]
    }
    ```



### IAM MFA

- Password Policy
  - Strong passwords = 계정의 보안을 높여줌
  - AWS password policy 세팅 방법
    - 비밀번호 최소 길이 설정
    - 특정 유형의 글자 사용 요구
    - IAM 사용자들의 비밀번호 변경 허용 및 금지
    - 일정 기간이 지나면 새 비밀번호 설정 요구
    - 사용자의 비밀번호 재사용을 막기
- MFA (Multi Factor Authentication)
  - 유저들은 AWS 계정에 접근할 수 있고 리소스들을 변경하고 삭제할 수도 있으므로 이 위험에서 계정을 보호해야함
  - MFA = password you know + security device you own
- AWS에서 MFA 장치 옵션
  - 가상 MFA 장치 (Virtual MFA device)
    - Google Authenticator (phone only)
    - Authy (multi- device)
    - 하나의 장치에서 여러 계정 및 사용자를 지원함
  - 범용 두 번째 인자 보안 키 (U2F - Universion 2nd Factor Security Key)
    - 물리적 장치
    - Yubico(AWS 제3자 회사) 의 YubiKey
    - 하나의 보안 키로 여러 루트 계정과 IAM 유저를 지원
  - 하드웨어 키 팝 MFA 장치 (Hardware Key Fob MFA Device)
    - 물리적 장치
    - Gemalto(AWS 제3자 회사)
  - 하드웨어 키 팝 MFA 장치 (미국 정부 AWS GovCloud 전용)
    - SurePassID(AWS 제3자 회사)



### AWS 엑세스 키, CLI 및 SDK

- 유저가 AWS에 접근하는 방법
  - AWS Management Console (protected by password + MFA)
  - AWS Command Line Interface (CLI): protected by access keys
  - AWS Software Developer Kit (SDK): for code -> protected by access keys
- 액세스 키 생성 방법
  - AWS Console을 사용해서 생성할 수 있음
  - 사용자들이 자신들의 액세스 키를 직접 관리
  - 액세스 키는 비밀번호와 마찬가지로 암호와 같음 
  - 액세스 키는 절대 공유 되면 안됨
  - Access Key ID ~= username
  - Secret Access Key ~= password
- AWS CLI
  - 명령줄 셀에서 명령어를 사용하여 AWS 서비스들과 상호작용할 수 있도록 해 주는 도구
  - 모든 명령어가 aws로 시작
  - CLI를 사용하면 AWS 서비스의 공용 API로 직접 액세스가 가능
  - CLI를 통해 리소스를 관리하는 스크립트 개발해 일부 작업을 자동화할 수 있음
- AWS SDK
  - 소프트웨어 개발 키트
  - 특정 언어로 된 라이브러리의 집합 => 프로그래밍 언어에 따라 개별 SDK가 존재
  - SDK를 사용하면 AWS 서비스의 공용 API로 직접 액세스가 가능
  - 터미널을 통한 접근이 아니라 코딩을 통해 애플리케이션 내에 심어두는 방식
  - 다양한 프로그래밍 언어 지원 (JavaScript, Python, PHP, .NET, Ruby, Java, Go, Node.js, C++)
  - 모바일 SDKs (Android, iOS, ...)
  - IoT Device SDKs (Embedded C, Ariduino, ...)
  - 예시: AWS CLI는 파이썬 AWS SDK로 구성 돼 있음



### AWS 클라우드쉘

- 특정 지역에서만 가능
- AWS 클라우드에서 무료로 사용 가능한 터미널같은 개념
- 장점
  - CLI를 사용할 때 API 호출을 반환 
    - --region 을 이용해 API 호출을 할 리전을 지정할 수도 있음
    - 클라우드쉘에서 기본 리전은 현재 로그인 된 리전
  - 전체 저장소가 있음
  - 구성이 가능
    - 글씨 크기, 테마 선택, 안전하게 붙여넣기 기능
    - 파일 업로드 및 다운로드 가능
    - 탭 구성 가능



### AWS 서비스에 대한 IAM Role

- AWS 서비스 몇 가지는 우리의 계정에서 실행해야 하며, 이를 위해서는 사용자와 마찬가지로 어떤 권한이 필요함
- IAM Role은 사용자와 같지만 실제 사람이 사용하도록 만들어진 것이 아니고 AWS 서비스에 의해 사용되도록 만들어짐



### IAM 보안 도구

- IAM 자격 증명 보고서(Credentials Report)
  - 계정 수준(account- level)에서 가능
  - 보고서는 계정에 있는 사용자와 다양한 자격 증명의 상태를 포함
- IAM 액세스 관리자(Access Adviser)
  - 사용자 수준(user-level)에서 가능
  - 사용자에게 부여된 서비스의 권한과 해당 서비스에 마지막으로 엑세스한 시간이 보임
  - 해당 도구를 사용하여 어떤 권한이 사용되지 않는지 볼 수 있고 따라서 사용자의 권한을 줄여 최소권한의 원칙을 지킬 수 있음



## Section 05. EC2 기초

### EC2 기초

- EC2(Elastic Compute Cloud): AWS에서 제공하는 서비스형 인프라스트럭처
- 포함하고 있는 서비스
  - 가상 머신 임대 (EC2) => EC2 인스턴스
  - 데이터를 가상 드라이브 또는 EBS 볼륨에 저장 (EBS)
  - 엘라스틱 로드 밸런서로 로드를 분산 (ELB)
  - 오토 스케일링 그룹을 통해 서비스를 확장(ASG)
- EC2의 사용법을 아는 것은 클라우드 작동 방식을 이해할 때 필수적
- EC2 사이징(Sizing) & 설정 옵션(configuration options)
  - Operating System (OS): Linux, Windows or Mac OS
  - CPU: 컴퓨티 성능과 코어의 양
  - RAM: 램덤 엑세스 메모리의 양
  - 용량 공간
    - 네트워크를 통해 연결할 스토리지 필요 여부 (EBS & EFS)
    - 하드웨어 (EC2 인스턴스 스토어)
  - 네트워크 카드: 속도가 빠른 카드, 어떤 종류의 공용 IP
  - 방화병 규칙: 보안 그룹
  - 부트스트랩 스크립트 (처음에 설정): EC2 사용자 데이터
- EC2 사용자 데이터
  - EC2 사용자 데이터 스크립트를 사용하여 인스턴스를 부트스트래핑할 수 있음
  - 부트스트래핑: 머신이 작동될 때 명령을 시작하는 것
  - 스크립트는 처음 시작할 때 한 번만 실행됨
  - EC2 사용자 데이터가 자동화하는 작업들
    - 업데이트
    - 소프트웨어 설치
    - 일반적인 파일들을 인터넷에서 다운로드
    - 우리가 생각하는 모든 것들
  - EC2 사용자 데이터 스크립트는 루트 계정에서 실행 => 모든 명령문은 sudo로 해야 함
- EC2 인스턴스를 재실행시, 사설 IP는 항상 같은 상태로 유지되지만 공용 IP는 변경될 수 있음



### EC2 인스턴스 유형 기본 사항

- EC2 인스턴스 유형 - 개요
  - https://aws.amazon.com/ec2/instance-types/
  - m5.2xlarge 의미
    - m: 인스턴스 클래스
    - 5: 인스턴스의 세대(generation)
    - 2xlarge: 인스턴스 클래스의 사이즈 => 크기가 클수록 더 높은 메모리와 CPU 개수를 가짐
- 범용 인스턴스
  - 웹 서버나 코드 저장소와 같은 다양한 작업에 적합
  - 컴퓨팅, 메모리, 네트워킹 간의 균형도 잘 맞음
  - t2.micro 도 범용 인스턴스
- 컴퓨팅 최적화 인스턴스
  - 컴퓨터 집약적인 작업에 최적화된 인스턴스
  - 사용 사례
    - 일부 데이터의 일괄 처리
    - 미디어 트랜스코딩 작업 시
    - 고성능 웹 서버가 필요할 때
    - 고성능 컴퓨팅이라는 HPC 작업을 할 때
    - 과학적 모델링 & 머신 러닝
    - 전용 게임 서버
  -  Computing을 나타내는 C로 시작하는 이름을 가지고 있음
- 메모리 최적화 인스턴스
  - 메모리에서 대규모 데이터셋을 처리하는 유형에 빠른 성능을 제공
  - 사용 사례
    - 고성능의 관계형 / 비관계형 데이터베이스
    - 분산 웹스케일 캐시 저장소
    - BI(business intelligence)에 최적화된 인 메모리 데이터베이스
    - 대규모 비정형 데이터의 실시간 처리를 실행하는 애플리케이션
  - 보통 Ram을 나타내는 R로 시작하는 이름을 가지고 있음 (X1 이나 대용량 메모리, Z1도 있음)
- 스토리지 최적화 인스턴스
  - 로컬 스토리지에서 대규모의 데이터셋에 엑세스할 때 적합한 인스턴스
  - 사용 사례
    - 고주파 온라인 트랜잭션 처리(OLTP) 시스템
    - 관계형 & NoSQL 데이터베이스
    - 메모리 데이터베이스의 캐시 (ex - Redis)
    - 데이터 웨어하우징 애플리케이션
    - 분산 파일 시스템
  - I, G, H1으로 시작하는 이름을 가지고 있음

- 인스턴스 정보 보는 사이트: https://www.ec2instances.info/



### 보안 그룹 및 클래식 포트 개요

- 보안 그룹 개요
  - 보안 그룹은 AWS 클라우드에서 네트워크 보안을 실행하는데 핵심이 됨
  - EC2 인스턴스에 들어오고 나가는 트래픽을 제어
  - 보안 그룹은 오직 허용 규칙만 포함함
  - 보안 그룹 또는 IP 주소를 참조해 규칙을 만들 수 있음

- 보안 그룹 딥 다이브
  - 보안 그룹은 EC2 인스턴스의 방화벽
  - 규제 목록
    - 포트로의 엑세스 통제
    - 인증된 IP 주소의 범위를 확인해 IPv4인지 IPv6인지 확인
    - 외부에서 인스턴스로 들어오는 인바운드 네트워크 통제
    - 인스턴스에서 외부로 나가는 아웃바운드 네트워크 통제
  - 타입, 프로토콜, 포트 범위, 소스, 설명으로 구성
- 보안 그룹에 대해 알아야 하는 것 
  - 여러 인스턴스에 연결할 수 있음 => 보안 그룹과 인스턴스 간의 일대일 관계는 없음
  - 보안 그룹은 지역과 VPC 결합으로 통제되어 있음
  - 보안 그룹은 EC2 외부에 있음 => 트래픽이 차단되면 EC2 인스턴스는 확인할 수 없음
  - SSH 액세스를 위해 하나의 별도 보안 그룹을 유지하는 것이 좋음
  - 타임아웃으로 애플리케이션에 접근할 수 없으면 보안 그룹의 문제
  - 어떤 포트에 연결을 시도하는데 컴퓨터가 계속 멈추고 대기하기만 한다면 보안 그룹의 문제
  - ''연결 거부'' 오류가 발생하면 보안 그룹은 실행됐고 트래픽은 통과했지만 애플리케이션에 문제가 생겼거나 실행되지 않은 등 문제가 발생한 것
  - 기본적으로 모든 인바운드 트래픽은 차단되어 있고, 모든 아웃바운드 트래픽은 허용되어 있음
- 알아야 하는 포트
  - 22번 포트 => SSH(Secure Shell): Linux에서 EC2 인스턴스로 로그인하도록 함
  - 21번 포트 => FPT(File Transfer Protocol): 파일 공유 시스템에 파일을 업로드하는데 사용
  - 22번 포트 => SFTP (Secure FIle Transfer Protocol): SSH를 통해서 전송되고 보안 파일 전송 프로토콜이 되기 때문에 22번 포트를 사용함
  - 80번 포트 => HTTP: 보안이 되지 않은 사이트에 액세스하기 위함
  - 443번 포트 => HTTPS: 보안이 된 사이트에 엑세스하기 위함
  - 3389 포트 => RDP (Remote Desktop Protocol): 윈도우 인스턴스에 로그인할 때 사용



###   SSH 개요

- Secure Shell(SSH): 터미널이나 명령줄을 이용해서 원격 머신이나 서버를 제어할 수 있게 해줌
- SSH: Linux, Windows 10+
- PuTTY: Windows
- EC2 Instance Connect: Linux, Windows



### EC2 Instance Connect

- AWS EC2에서 실행
- 브라우저 기반으로  EC2 인스턴스에 대한  SSH 세션을 실행할 수 있음
- 임시 SSH키를 대신 업로드하고 접속을 하기 때문에 SSH 키를 따로 관리할 필요가 없음
- Amazone Linux AMI는 AWS CLI를 포함하고 있음 



### EC2 인스턴스 시작

- EC2 인스턴스에 엑세스 키  ID와 비밀 엑세스키를 입력하면 절대 안됨 => EC2 인스턴스 역할에서 IAM 역할을 사용하기

- EC2 인스턴스 구매 옵션

  - 온-디멘드 인스턴스 (On-Demand Instances)
    - 단기적 워크로드
    - 비용 예측 가능
    - 초 단위의 요금 지불
  - 예약 (Reserved) (1 & 3 년)
    - 예약 인스턴스: 장기적 워크로드
    - 전환형 예약 인스턴스: 유연한 인스턴스 타입
  - 절약 플랜 (Saving Plans) (1 & 3년)
    - 특정한 인스턴스 유형을 약정하는 게 아니라 달러 단위로 특정한 사용량을 약정
    - 장기적 워크로드

  - 스폿 인스턴스 (Spot Instances)
    - 단기적 워크로드
    - 매우 저렴
    - 언제라도 인스턴스들이 손실될 수 있어서 낮은 신뢰성을 가짐
  - 전용 호스트 (Dedicated Hosts)
    - 물리적 서버 전체를 예약해서 인스턴스 배치를 제어할 수 있음
  - 전용 인스턴스 (Dedicated Instances)
    - 다른 고객들이 자신의 하드웨어를 공유하지 않음
  - 용량 예약 (Capacity Reservations)
    - 원하는 기간 동안에 특정한  AZ(Availabilty Zone: 가용성 영역)에 용량을 예약할 수 있음

- EC2 On Demand

  - Linux나  Window 사용시: 1분 이후에 초 단위로 청구
  - 다른 모든 운영체계: 1시간 단위로 청구
  - 비용이 가장 많이 들지만 바로 지불한 금액은 없음
  - 장기적인 약정도 필요 없음
  - 단기적이고 중단 없는 워크로드가 필요할 때, 또는 애플리케이션의 거동을 예측할 수 없을 사용

- EC2 Reserved Instances (예약 인스턴스)

  - 예약 인스턴스는 온디맨드에 비해 최대 72%까지 할인을 제공
  - 특정한 인스턴스 속성을 예약 (인스턴스 타입, 리전, 테넌시, OS)
  - 예약 기간을 1년(+discount) 이나 3년(+++discount) 으로 지정해서 할인을 더 받을 수 있음
  - 결제 옵션: 모두 선결제(+++discount)  / 부분 선결제(++discount) / 선결제 없음(+discount)
  - 범위를 특정한 리전이나 존으로 할 수 있음 (특정한 AZ에 있는 예약된 용량)
  - 사용량이 일정한 애플리케이션에 예약 인스턴스를 사용하는게 좋음 (ex - database)
  - 예약 인스턴스를 마켓플레이스에서 살 수 있고, 더 이상 필요가 없어지면 팔 수도 있음
  - 전환형 예약 인스턴스 (Convertible Reserved Instance)
    - 인스턴스 타입, 인스터스 패밀리, 운영체계, 범위, 테넌시를 변경할 수 있음
    - 최대 66%까지 할인을 제공

- EC2 Saving Plans

  - 장기간 사용하면 할인을 받을 수 있음 (최대 72% - RI와 같음)
  - 다음 1년 내지 3년 동안 시간당 10달러로 약정을 하게 됨
  - 사용량이 한도를 넘어서면 절약 플랜은 온디맨드 가격으로 청구를 하게 됨
  - 특정한 인스턴스와 패밀리, 리전으로 고정됨
  - 유연한 속성
    - 인스턴스 사이즈
    - OS
    - 테넌시 (호스트, 전용, 기본)

- EC2 Spot Instances

  - 최대 90프로까지 할인
  - 스폿 인스턴스에 대해 지불하려는 최대 가격을 정의하고 만일 스폿 가격이 그 가격을 넘게 되면 인스턴스가 손실됨
  - AWS에서 가장 비용효율적인 인스턴스

  - 고장에 대한 회복력이 있는 워크로드에 유용
    - 배치 작업
    - 데이터 분석
    - 이미지 처리
    - 모든 종류의 분산형 워크로드
    - 시작 시간과 종료 시간이 유연한 워크로드
  - **아주 중요한 작업이나 데이터베이스에는 적절하지 않음**

- EC2 Dedicated Hosts

  - 활용 사례에 전용으로 사용되는 EC2 인스턴스 용량이 있는 실제 물리적 서버를 받게 됨
  - 물리적 서버 자체에 대한 접근권을 갖고 낮은 수준의 하드웨어에 대한 가시성을 제공해 줌
  - 기존의 서버에 연결된 소프트웨어 라이선스가 있는 경우 (법규 준수 요건이 있는 활용 사례나 소켓, 코어, VM 소프트웨어 라이센스)

  - 구매 옵션
    - 온-디멘드: 초당 비용 지불
    - 예약: 1 or 3년 (선결제, 부분결제, 후결제)
  - 가장 비싼 옵션 => 실제로 물리적 서버를 예약하기 때문
  - 활용 사례
    - 라이선싱 모델과 함께 사용되는 소프트웨어 (BYOL - Bring Your Own License)
    - 규정이나 법규를 반드시 준수해야 하는 회사

- EC2 Dedicated Instances

  - 전용 하드웨어에서 실행되는 인스턴스
  - 자신만의 인스턴스를 자신만의 하드웨어에 가짐
  - 같은 계정에서 다른 인스턴스와 함께 하드웨어를 공유할 수 있음
  - 인스턴스 배치에 대한 통제권이 없음

- EC2 Capacity Reservations

  - 원하는 기간 동안 특정한  AZ에서 온디맨드 인스턴스를 예약할 수 있음
  - 필요할 때마다 예약한 용량에 접근 가능
  - 기간 약정은 없음 (언제든 예약, 취소 가능)
  - 청구 할인도 없음
  - 지역별 예약 인스턴스와 결합하거나 절약 플랜과 결합해서 요금 할인 가능
  - 인스턴스를 실행하는지에 무관하게 온디맨드 요금이 부과됨
  - 특정한 AZ에 있어야 하는 단기적이고 중단 없는 워크로드에 아주 적합



### 스팟 인스턴스 및 스팟 집합

- 최대 스팟 가격을 정의하고, 인스턴스의 현재 스팟 가격이 정의한 최대 스팟 가격을 넘지 않으면 실행됨
  - 시간당 스팟 가격은 오퍼와 용량에 따라 달라짐
  - 현재 스팟 가격이 최대 스팟 가격을 초과하면 2가지 옵션이 있으며 2분의 유예 기간을 줌
    - 인스턴스 중지: 어느 날 스팟 가격이 최대 가격 아래로 내려가면 인스턴스를 다시 시작하고 중단했던 곳부터 재개
    - 인스턴스 종료: 인스턴스 상태가 필요하지 않다면 종료 후 작업을 다시 시작할 때 새로운 EC2 인스턴스로 시작
- 스팟 블록 (Spot Block)
  - 지정된 기간 동안 스팟 인스턴스를 차단
  - 1~6시간까지 가능하며, 그동안 중단 없이 해당 블록을 사용할 수 있음
  - 하지만 아주 드물게 인스턴스가 회수되는 경우가 있음
  - 현재 AWS에서 지원을 하지 않으나 가끔 시험에 나옴
- 스팟 인스턴스 종료법
  - 스팟 요청 유형은 일회성 인스턴스 요청과 영구 인스턴스 요청으로 나뉨
    - 일회성 인스턴스 요청은 한 번의 스팟 요청으로 끝남
    - 영구 인스턴스 요청은 인스턴스가 어떤 이유로든 중지되는 경우 스팟 요청이 다시 실행되고, 유효성이 확인되면, 스팟 인스턴스가 다시 시작됨
  - 따라서 영구 인스턴스 요청 유형의 스팟 요청을 가지는 스팟 인스턴스를 종료하려면 스팟 요청을 먼저 취소해야함
- 스팟 플릿 (Spot Fleets)
  - 스팟 플릿 = 스팟 인스턴스 세트 + (optional) 온디맨드 인스턴스 세트
  - 사용자가 정의한 가격 제한으로 목표 용량을 충족하기 위해 최선을 다함
    - 가능한 런치 풀에서 시작: 다양한 인스턴스 유형, 다양한  OS 및 다양한 가용성 영역을 가질 수 있음
    - 다양한 런치 풀을 정의하게 되고, 플릿이 가장 적합한 런치 풀을 선택함
    - 스팟 플릿이 예산에 도달하거나 원하는 용량에 도달하면 인스턴스 시작을 중지함
  - **스팟 플릿에 스팟 인스턴스를 할당하는 전략**
    - 최저 가격 (lowestPrice): 가장 낮은 가격인 풀에서 인스턴스를 시작 (비용이 최적화, 매우 짧은 워크로드)
    - 다양한 방법 (diversified): 사용자가 정의한 모든 풀에 분산됨 (가용성에 좋음 => 한 풀이 사라져도 다른 풀은 여전히 활성화 돼 있으므로, 긴 워크로드)
    - 용량 최적화 (capacityOptimized): 원하는 인스턴스 수에 맞는 최적의 용량을 가진 풀을 가짐
    - 가격 용량 최적화 (priceCapacityOptimized): 먼저 사용 가능한 용량이 가장 큰 풀을 선택하고 그 중 가격이 가장 낮은 풀을 선택하는 전략 (recommended, 대부분의 워크로드에 가장 적합)
  - 스팟 플릿을 사용하면 여러 개의 런치 풀과 여러 인스턴스 유형을 정의할 수 있고 가장 낮은 가격으로 자동으로 스팟 인스턴스를 요청함



## Section 06. EC2 - 솔루션스 아키텍트 어소시에이트 레벨

### 프라이빗 vs 퍼블릭 vs 탄력적 IP

- private vs public IP (IPv4)
  - IPv4 vs IPv6
    - IPv4: 1.160.10.240
    - IPv6: 3ffe:1900:4545:3:200:f8ff:fe21:67cf
  - 강의에선 IPv4만 사용할 것이지만 AWS는 IPv6도 지원함
  - IPv4는 현재 온라인에서 가장 널리 사용되는 형식
  - IPv6는 많은 문제를 해결해주며, IoT(사물 인터넷)에 더 많이 쓰임
  - IPv4는 공용 공간에서 37억 개의 서로 다른 주소를 허용 => 이제  IP 주소가 거의 고갈되어 가고 있음
  - IPv4: [0-255].[0-255].[0-255].[0-255].
  - Private vs Public IP
    - 공용  IP
      - 인터넷 전역에 액세스할 수 있음
      - 기기가 인터넷상에서 식별될 수 있음
      - 각 공용 IP는 전체 웹에서 유일함
      - IP의 지리적 위치를 쉽게 찾을 수 있음
    - 사설  IP
      - 사설 네트워크 내에서만 액세스할 수 있음
      - 기기가 오직 사설 네트워크 안에서만 식별될 수 있음
      - IP가 사설 네트워크 안에서만 유일하면 됨
      - 두 개의 다른 사설 네트워크는 같은 사설 IP를 가질 수 있음
      - 기기가 사설 네트워크에 있을 때 NAT 장치와 프록시 역할을 할 인터넷 게이트웨이를 통해 인터넷에 연결됨
      - 지정된 범위의 IP만 사설 IP로 사용될 수 있음
- Elastic IPs (탄력적 IP)
  - EC2 인스턴스를 시작하고 중지할 때 공용 IP를 바꿀 수 있음
  - 인스턴스에 고정된 공용 IP를 사용하면 탄력적 IP가 필요하게 됨
  - 탄력적 IP는 공용 IPv4인데 삭제하지 않는 한 계속 가지고 있게 됨
  - 한 번에 한 인스턴스에만 첨부할 수 있음
  - IP 주소가 탄력적이면 한 인스턴스에서 다른 인스턴스로 빠르게 이동함으로써 인스턴스 또는 소프트웨어의 오류를 마스킹할 때 사용할 수 있음 (드문 경우)
  - 계정당 탄력적 IP를 5개만 쓸 수 있음 (AWS에 개수 증가를 요청할 수 있음)
  - 결론적으로, 탄력적 IP는 사용하지 않는 것이 좋음
    - 매우 좋지 않은 구조적 결정
    - 대신, 임의의 공용 IP를 써서 DNS 이름을 할당하는 것이 좋음
- AWS EC2
  - 기본값으로 EC2 기기는 내부 AWS 네트워크엔 사설 IP, www(world wide web)엔 공용 IP를 사용
  - EC2 머신에 SSH를 사용할 때
    - 사설 IP를 사용할 수 없음 => 같은 네트워크에 있지 않으므로
    - 공용 IP만 사용할 수 있음
  - **기기가 멈췄다가 다시 시작하면 공용 IP가 바뀔 수 있음**



### EC2 배치 그룹 (Placement Groups)

- EC2 인스턴스가  AWS 인프라에 배치되는 방식을 제어하고자 할 때 사용
- 배치 그룹을 사용하여 전략을 정의 가능
- 배치 그룹을 만들 때 세 가지 전략을 사용할 수 있음
  - 클러스터 (Cluster): 단일 가용 영역 내에서 지연 시간이 짧은 하드웨어 설정으로 인스턴스를 그룹화
  - 분산 (Spread): 인스턴스가 다른 하드웨어에 분산 (가용 영역별로 분산된 배치 그룹당 최대 7개의 인스턴스를 가질 수 있음) => 크리티컬 애플리케이션이 있는 경우
  - 분할 (Partition): 여러 파티션에 인스턴스가 분할되어 있고, 이 파티션은 가용 영역 내의 다양한 하드웨어 랙 세트에 의존. 그룹당 수백 개의 EC2 인스턴스를 통해 확장할 수 있고 이를 통해 Hadoop, Cassandra, Kafka 같은 애플리케이션을 실행할 수 있음
- Placement Groups Cluster
  - 모든 EC2 인스턴스가 동일한 랙(=동일한 하드웨어 및 가용 영역)에 있음
  - 장점: 매우 빠른 네트워크
  - 단점: 랙에 실패가 발생하면 모든 EC2 인스턴스가 동시에 실패함
  - 사용 사례
    - 빅데이터 작업
    - 극히 짧은 지연 시간과 높은 네트워크 처리량을 필요로 하는 애플리케이션이 있는 요청
- Placement Groups Spreds
  - 실패 위험을 최소화
  - 모든 EC2 인스턴스가 다른 하드웨어에 위치
  - 장점: 여러 가용 영역에 걸쳐 있을 수 있으며, 동시 실패의 위험이 감소
  - 단점: **배치 그룹의 가용 영역당 7개의 인스턴스로 제한이 됨**
  - 사용 사례
    - 가용성을 극대화하고 위험을 줄여야 하는 애플리케이션
    - 인스턴스 오류를 서로 격리해야하는 크리티컬 애플리케이션
- Placement Groups Partition
  - 가용 영역당 최대 7개의 파티션이 있을 수 있음
  - 이러한 파티션은 동일한 리전의 여러 가용 영역에 걸쳐 있을 수 있음
  - 설정으로 최대 수백 개 EC2 인스턴스를 얻을 수 있음
  - 인스턴스와 파티션은 다른 파티션의 인스턴스와 동일한 하드웨어 물리적 랙을 공유하지 않으므로 각 파티션은 실패로부터 격리됨
  - EC2 인스턴스가 어떤 파티션에 있는지 알기 위해 메타데이터 서비스를 사용하여 이 정보에 액세스하는 옵션이 있음
  -  사용 사례
    - 대규모의 분산 및 복제된 워크 로드
    - HDFS, HBase, Cassandra, Kafka



### ENI (탄력적 네트워크 인터페이스)

- Elastic Network Interfaces (ENI)
  - VPC의 논리적 구성 요소이며 가상 네트워크 카드를 나타냄
  - ENI는 EC2 인스턴스가 네트워크에 액세스할 수 있게 해줌
  - ENI는 EC2 인스턴스 외부에서도 사용됨
  - 속성
    - 주요 사설 IPv4와 하나 이상의 보조 IPv4를 가질 수 있음
    - 각 ENI는 사설 IPv4당 탄력적 IPv4를 갖거나 혹은 하나의 공용 IPv4를 가질 수 있음
    - ENI에 하나 이상의 보안 그룹을 연결할 수 있음
    - MAC 주소 및 기타 항목을 연결할 수 있음
  - EC2 인스턴스와 독립적으로 ENI를 생성하고 즉시 연결하거나 장애 조치를 위해  EC2 인스턴스에서 이동시킬 수 있음
  - 특정 가용 영역, 즉  AZ에 바인딩 됨



### EC2 절전(Hibernate) 모드

- 인스턴스 중지 방법
  - 중지 (Stop): 디스크 데이터(EBS)는 다시 시작할 때까지 그대로 유지
  - 종료 (Terminate)
    - 루트 볼륨이 삭제되게 했다면 인스턴스도 삭제
    - 그렇게 설정하지 않은 다른 볼륨은 인스턴스가 종료되더라도 그대로 남음
- 인스턴스 다시 시작시 발생하는 일
  - 첫 시작: OS가 먼저 부팅되기 시작하고 EC2 사용자 데이터 스크립트도 실행
  - 시작 후: 운영 체제가 부팅이 완료
  - 애플리케이션이 실행되고 캐시도 구성되므로 과정이 끝날 때까지 시간이 다소 걸림
- EC2 절전 모드
  - EC2 절전 모드 소개
    - 인 메모리(RAM) 상태는 그대로 보존
    - 인스턴스 부팅이 더 빨라짐 (OS를 완전히 중지하거나 재시작하지 않았으므로)
    - 백그라운드: RAM에 기록되었던 인 메모리 상태는 루트 경로의 EBS 볼륨에 기록됨
    - 루트 EBS 볼륨을 암호화해야 하고 볼륨 용량도 RAM을 저장하기에 충분해야 함
  - 사용 사례
    - 오래 실행되는 프로세스를 갖고 있고 중지하지 않을 때
    - RAM 상태를 저장하고 싶을 때
    - 빠르게 재부팅을 하고 싶을 때





## Section 07. EC2 인스턴스 스토리지

### EBS 개요

- EBS Volume?
  - EBS (Elastic Block Store) Volume: 인스턴스가 실행 중인 동안 연결 가능한 네트워크 드라이브
  - EBS 볼륨을 사용하면 인스턴스가 종료된 후에도 데이터를 지속할 수 있음
  - CCP 레벨: 하나의 EBS는 하나의 EC2 인스턴스에만 마운트 가능(단, 여러개의 EBS가 하나의 EC2 인스턴스에도 마운트가 가능함)
  - 어소시에이트 레벨: 일부 EBS 다중 연결
  - EBS 볼륨을 생성할 때는 특정 가용 영역에서만 가능
  - 네트워크 USB 스틱과 같은 역할
  - Free tier: 매달 30GB의 EBS 스토리지를 범용 SSD 혹은 마그네틱 유형으로 제공
- 특징
  - 네트워크 드라이브 => 물리적 드라이브가 아님
    - 인스턴스와 EBS 볼륨이 서로 통신을 하기 위해서는 네트워크를 필요로 함 => 따라서 컴퓨터가 다른 서버에 도달할 때 지연이 발생할 수 있음
    - EC2 인스턴스에서 분리될 수 있고 매우 빠르게 다른 인스턴스로 연결될 수 있음
  - 특정한 가용 역역(AZ)에 고정되어 있음
    - 하지만 스냅샷을 이용하면 다른 가용 역역으로도 볼륨을 옮길 수 있음
  - 볼륨이기 때문에 용량을 미리 결정해야 함
    - 원하는 양의  GB 및 IOPS(단위 초당 전송 수)
    - 해당 프로비전 용량에 따라 요금이 청구됨
    - 더좋은 성능이나 큰 사이즈가 필요하면 이후에 용량을 늘릴 수도 있음 
- **EBS - 종료 시 삭제 속성**(Delete on Termination attribute)
  - 이 옵션을 통해 EC2 인스턴스 종료 시 EBS 행동을 제어할 수 있음
    - 루트 EBS 볼륨은 디폴트 값으로 인스턴스 종료와 함께 삭제되도록 설정이 되어 있음 (활성 상태)
    - 다른 EBS 볼륨은 디폴트 값으로 삭제되지 않도록 설정이 되어 있음 (비활성 상태)
  - 종료 시 삭제 활성화 여부는 원하는 대로 조작이 가능
  - 종료 시 삭제 속성 비활성 상태 사용 예시
    - 인스턴스가 종료될 때 루트 볼륨을 유지하고자 하는 경우
    - 데이터를 저장하고자 하는 경우



### EBS 스냅샷 개요

- EBS 스냅샷
  - EBS 볼륨의 특정 시점에 대한 백업
  - EC2 인스턴스에서 EBS 볼륨을 분리할 필요는 없지만 권장 사항임
  - EBS 스냅샷은 다른 가용 역역이나 다른 리전에도 복사할 수도 있음
- 기능
  - EBS 스냅샷 아카이브(EBS Snapshot Archive)
    - 최대 75%까지 저렴한 아카이브 티어로 스냅샷을 옮길 수 있는 기능
    - 스냅샷을 아카이브 티어로 옮기면 아카이브를 복원하는데 24시간에서 최대 72시간이 걸림
  - EBS 스냅샷 휴지통(Recycle Bin for EBS Snapshots)
    - EBS 스냅샷을 삭제하는 경우 영구 삭제하는 대신에 휴지통에 넣을 수 있음 (복원 가능)
    - 휴지통에 보관되는 기간은 1일에서 1년 사이로 설정할 수 있음
  - 빠른 스냅샷 복원(FSR - Fast Snapshot Restore) 
    - 스냅샷을 완전 초기화해 첫 사용에서의 지연 시간을 없애는 기능
    - 스냅샷이 아주 크고 EBS 볼륨 또는 EC2 인스턴스를 빠르게 초기화해야 할 때 특히 유용
    - 비용이 많이 드니 사용에 유의



### AMI 개요

- AMI
  - AMI(Amazon Machine Image): EC2 인스턴스를 통해 만든 이미지를 통칭
  - AMI로 EC2 인스턴스를 원하는 대로 변경 가능
    - 원하는 소프트웨어 또는 설정 파일, 별도의 운영 체제, 모니터링 툴을 추가 가능
    - AMI를 따로 구성하면 부팅 및 설정에 드는 시간을 줄일 수 있음 => 우리가  EC2 인스턴스에 설치하고자 하는 모든 소프트웨어를 AMI가 미리 패키징해주기 떄문
  - AMI는 특정 지역에 구축 (다른 지역으로 복사도 가능)
  - EC2 인스턴스를 여러 종류의  AMI에서 실행 가능
    - A Public AMI(전체 공개 AMI): AWS에서 제공
    - Your own AMI(자체적으로 구성한 AMI): 직접 만들고 유지, 관리도 직접 해야 함
    - An AWS Marketplace AMI: 다른 사람이 구축한 AMI (보통은 구매한 이미지)
- AMI Process (from an EC2 instance)
  - 먼저 EC2 인스턴스를 원하는 대로 설정
  - 인스턴스를 중지해 데이터 무결성을 확보
  - 이 인스턴스를 바탕으로 AMI를 구축 (이 과정에서 EBS 스냅샷이 생성됨)
  - 다른 AMI에서 인스턴스를 실행할 수 있음



### EC2 인스턴스 스토어

- EC2 인스턴스 스토어
  - EBS 볼륨은 네트워크 드라이브이기 때문에 뛰어나지만 제한된 성능을 가짐
  - 고성능의 하드웨어 디스크 성능이 필요하다면, EC2 인스턴스 스토어를 사용해야 함
  - I/O 성능 향상을 위해 활용할 수 있음
  - EC2 인스턴스 스토어를 중지 또는 종료하면 해당 스토리지 또한 손실됨 => 단기 스토리지 기능
  - 사용 예시: 버퍼 / 캐시 / 스크래치 데이터 / 임시 콘텐츠
  - EC2 인스턴스의 기본 서버에 장애가 발생할 시에는 해당 EC2 인스턴스가 연결된 하드웨어에도 장애가 발생하므로 데이터 손실에 대한 위험이 존재
  - 필요에 따라 데이터를 백업해 두거나 복제해 둬야 함



### EBS 볼륨 유형

- EBS 볼륨 유형 (6 types)

  - gp2 / gp3 (SSD)
    - 범용 SSD 볼륨 
    - 다양한 워크로드에 대해 가격과 성능의 절충안이 됨
  - io1 / io2 (SSD)
    - 최고 성능을 자랑하는 SSD 볼륨
    - 미션 크리티컬이자 지연 시간이 낮고 대용량의 워크로드에 쓰임
  - st1 (HDD)
    - 저비용의 HDD 볼륨
    - 잦은 접근과 처리량이 많은 워크로드에 쓰임
  - sc1 (HDD)
    - 가장 비용이 적게 드는 HDD 볼륨
    - 접근 빈도가 낮은 워크로드를 위해 설계됨

  - 크기, 처리량, IOPS 에 따라 EBS 볼륨 유형이 나뉨
  - gp2 / gp3와  io1 / io2 만이 부팅 볼륨으로 사용될 수 있음

- General Purpose SSD (gp2 / gp3)

  - 짧은 지연 시간, 효율적인 비용의 스토리지
  - 시스템 부팅 볼륨 및 가상 데스크톱, 개발, 테스크 환경에서 사용할 수 있음
  - 크기: 1GB ~ 16TB
  - gp3
    - 최신 세대의 볼륨
    - 기본 성능으로 3,000 IOPS와 125MB/s의 처리량을 제공
    - IOPS는 최대 16,000, 처리량은 최대 1,000MB/s까지 증가시킬 수 있음
  - gp2
    - 최대 3,000 IOPS
    - 볼륨과 IOPS가 연결되어 있으며,  최대  IOPS는 16,000
    - 1GB 당 3IOPS

- Provisioned IOPS (PIOPS) SSD (io1 / io2)

  - IOPS 성능을 유지할 필요가 있는 주요 비즈니스 애플리케이션
  - 16,000 IOPS 이상을 필요로 하는 애플리케이션
  - 일반적으로 데이터베이스 워크로드에 알맞음 (스토리지 성능과 일관성에 민감)
  - io1 / io2 (4GB ~ 16TB)
    - 최대 POIPS: **Nitro EC2 인스턴스에서 64,000 IOPS**  / 나머지는 32,000  IOPS
    - 프로비저닝된  IOPS의 스토리지 크기를 독자적으로 증가시킬 수 있음
    - io2는 io1과 동일한 비용으로 내구성과 기기 당  IOPS의 수가 더 높음 (2가 더 합리적)
  - io2 Block Express (4GB ~ 64TB)
    - 고성능 유형의 볼륨
    - 지연 시간이 밀리초 미만
    - IOPS 대 GB 비율이 1,000 : 1  일 때 최대 256,000 IOPS
  - EBS 다중 연결을 지원

- Hard Disk Drives (HDD) (st1 / sc1)

  - 부팅 볼륨이 될 수 없음
  - 125MB ~ 16TB
  - 처리량 최적화(Throuhput Optimized) HDD (st1)
    - 처리량 최적화 HDD
    - 빅 데이터나 데이터 웨어하우징 로그 처리에 적합
    - 최대 처리량은 초당 500MB, 최대 IOPS는 500
  - 콜드(Cold) HDD (sc1)
    - 아카이브 데이터용
    - 접근 빈도가 낮은 데이터에 적합
    - 최저 비용으로 데이터를 저장할 때 사용
    - 최대 처리량은 초당 250MB, 최대 IOPS는 250



### EBS 다중 연결

- EBS 다중 연결 - io1 / io2 제품군
  - 하나의 EBS 볼륨을 같은 가용 영역에 있는 여러 EC2 인스턴스에 연결할 수 있게 해 줌
  - 각 인스턴스는 고성능 볼륨에 대한 읽기 및 쓰기 권한을 전부 가짐 => 동시에 읽고 쓸 수 있음
  - 사용 사례
    - 애플리케이션 가용성을 높이기 위해 클러스터링된 Linux 애플리케이션 (ex: Teradata)
    - 애플리케이션이 동시 쓰기 작업을 관리해야 할 때
  - **한 번에 16개**의  EC2 인스턴스만 같은 볼륨에 연결 가능
  - 반드시 클러스터 인식 파일 시스템을 사용해야 함 (not XFS, EX4, etc)



### EBS 암호화

- EBS 암호화(Encryption)
  - EBS 볼륨을 생성하면 즉시 다음과 같은 일이 동시다발적으로 일어남
    - 저장 데이터가 볼륨 내부에 암호화
    - 인스턴스와 볼륨 간의 전송 데이터가 암호화
    - 모든 스냅샷이 암호화
    - 스냅샷으로 생성한 볼륨도 암호화
  - 암호화 및 복호화 메커니즘은 보이지 않게 처리 됨 (아무것도 할 필요가 없음)
  - 암호화는 지연 시간에는 영향이 거의 없음
  - KMS에서 암호화 키를 생성해 AES-256 암호화 표준을 가짐
  - 스냅샷을 복사해 함호화를 푼 걸 다시 암호화 활성화를 함
- EBS 볼륨 암호화 및 암호화 풀기
  - 볼륨의 EBS 스냅샷을 생성
  - 복사 기능을 통해 EBS 스냅샷을 암호화함
  - 스냅샷을 이용해 새 EBS 볼륨을 생성 (해당 볼륨 또한 암호화 됨)
  - 암호화된 볼륨을 인스턴스 원본에 연결



### Amazon EFS

- Amazon EFS - Elastic File System

  - 네트워크 파일 시스템: 많은  EC2 인스턴스에 마운트될 수 있음
  - EC2 인스턴스는 서로 다른 가용성 영역에 있을 수 있음
  - 가용성이 높고 확장성이 뛰어나며 비쌈 (gp2 EBS 볼륨의 약 3배)
  - 사용량에 따라 비용 지불
  - 사용사례: 콘텐츠 관리, 웹 서빙, 데이터 공유, Wordpress
  - 내부적으로 NFSv4.I protocol 을 사용
  - EFS에 대한 엑세스를 제어하려면 보안 그룹을 설정해야 함
  - **Linux 기반 AMI와만 호환됨 (윈도우 X)**
  - KMS를 사용해서 EFS 드라이브에서 미사용 암호화를 활성화 가능
  - POSIX 파일 시스템 (Linux 전용) 사용 => 표준 파일  API를 가짐
  - 파일 시스템은 자동으로 확장되며 EFS에서 사용하는 데이터 GB 사용량에 따라 비용을 지불

- EFS - 성능 클래스

  - EFS Scale
    - 수천 개의 동시 NFS 클라이언트, 10GB/s 이상의 처리량
    - PB(Petabyte) 규모의 네트워크 파일 시스템으로 자동 확장 가능

  - 성능 모드(Perfomance Mode) (EFS 생성 시에 설정 가능)
    - 범용 (기본값): 지연시간에 민감한 사용 사례에 사용 (웹 서버, CMS)
    - 최대 I/O: 지연시간이 길지만, 처리량이 높고 병렬성이 높음 (빅 데이터 애플리케이션, 미디어 처리)
  - 처리량 모드(Throughput Mode)
    - 버스팅(Bursting): 1TB = 50Mb/s + 100Mb/s 버스트
    - 프로비저닝(Provisioned): 스토리지 크기에 관계없이 처리량을 설정하고 싶은 경우 (ex: 1Gb/s for 1Tb 용량)
    - 엘라스틱(Elastic): 워크로드에 따라 처리량을 자동으로 조절
      - 읽기 최대  3Gb/s, 쓰기 최대 1Gb/s
      - 워크로드를 예측하기 어려울 때 유용

- EFS - 스토리지 클래스

  - 스토리지 티어(Storage Tiers): 며칠 후 파일을 다른 계층으로 옮길 수 있는 기능

    - Standard: 자주 액세스하는 파일
    - Infrequent access(EFS-IA)
      - 자주 엑세스 하지 않는 파일
      - 낮은 비용
      - 이 계층에서 파일을 검색할 경우 비용이 발생
      - 사용하려면 수명 주기 정책을 사용해야 함

  - 가용성과 내구성(Availability and durability)

    - Standard: 다중 AZ, 프로덕션 사용 사례에 적합 => 가용성 영역 하나가 다운되더라도 EFS 파일 시스템에 영향을 미치지 않으므로
    - One Zone(EFS One Zone-IA): 하나의 AZ, 개발용으로 적합, 백업이 기본적으로 활성화, 엑세스 빈도가 낮은 스토리지 계층과 호환되지 않음

  - 최대 90% 비용할인 가능

    

### EBS 대 EFS

- EBS(Elastic Block Storage)
  - EBS volumes
    - 하나의 인스턴스에만 첨부 (io1/io2의 다중 첨부 기능 제외)
    - AZ 수준에서 잠김
    - gp2: 디스크 크기가 증가하면 IO가 증가
    - Io1: 독립적으로 IO를 늘릴 수 있음
  - AZ 간에 EBS 볼륨 마이그레이션 방법
    - 스냅샷을 찍어야 함
    - 스냅샷을 다른 AZ로 복원
    - EBS 볼륨 백업은 IO를 사용하므로, 애플리케이션이 많은 트래픽을 처리하는 경우엔 실행하지 않아야 함 => EC2 성능에 영향을 미칠 수 있음
  - EBS 인스턴스의 루트 EBS 볼륨은 EC2 인스턴스가 종료되면 기본적으로 종료됨 (비활성화 가능)
- EFS(Elastic FIle System)
  - 여러 가용성 영역에 걸친 수백 개의 인스턴스에 첨부
  - 여러 인스턴스가 하나의 파일 시스템을 공유
  - WordPress와 같은 웹사이트 파일을 공유
  - Linux 전용 (POSIX 시스템)
  - EBS보다 가격대가 높음 
  - EFS-IA 기능을 활용하여 비용 절감 가능



## Section 08. 고가용성 및 스케일링성: ELB 및 ASG

### 고가용성 및 스케일링성

- 확장성 및 고가용성 (Scalability & High Availability)
  - 확장성: 애플리케이션 시스템이 조정을 통해 더 많은 양을 처리할 수 있음
  - 종류
    - 수직 확장성 (Verical Scalability)
    - 수평 확장성 = 탄력성 (Horizontal Scalability = elasticity)
  - 확장성은 고가용성과 연관된 개념이지만 다름
- 수직 확장성
  - 인스턴스의 크기를 확장하는 것을 의미
  - ex: t2.micro => t2.large
  - 데이터베이스와 같이 분산되지 않은 시스템에서 흔히 사용됨
  - RDS, ElastiCache 등의 데이터베이스에서 찾아볼 수 있음
  - 일반적으로 확장할 수 있는 정도에는 한계가 있음 (하드웨어 제한에 의해)
- 수평 확장성
  - 애플리케이션에서 인스턴스나 시스템의 수를 늘리는 방법
  - 수평 확장은 분배 시스템이 있다는 걸 의미
  - 웹이나 현대적 애플리케이션은 대부분 분배 시스템으로 이루어져 있음
  - 요즘은 Amazon EC2와 같은 클라우드 제공 업체 덕분에 수평적인 확장이 수월해짐
- 고가용성
  - 수평 확장성과 함께 사용되는 개념이지만 같진 않음
  - 애플리케이션 또는 시스템을 적어도 둘 이상의 AWS의 AZ나 데이터 센터에서 가동 중이라는 걸 의미
  - 데이터 센터에서의 손실에서 살아남는 것이 목표 => 센터 하나가 멈춰도 계속 작동 가능
  - 고가용성은 수동적일 수 있음 (ex: RDS 다중 AZ를 갖추고 있는 경우)
  - 고가용성은 활성형일 수 있음 (ex: 수평 확장)
- EC2의 고가용성 & 확장성
  - 수직 확장: 인스턴스의 크기를 늘리는 것 (= 스케일 업 / 다운)
  - 수평 확장: 인스턴스의 수를 늘리는 것 (= 스케일 아웃 / 인)
  - 고가용성
    - 동일 애플리케이션의 동일 인스턴스를 다수의 AZ에 걸쳐 실행하는 경우
    - 다수 AZ의 오토 스케일링 그룹
    - 다수 AZ의 로드 밸런서



### Elastic Load Balancing (ELB)

- 로드 밸런싱?

  - 서버 혹은 서버셋으로 트래픽을 백엔드나 다운스트림 EC2 인스턴스 또는 서버들로 전달하는 역할을 함

- 사용 이유

  - 부하를 다수의 다운스트림 인스턴스로 분산하기 위해
  - 애플리케이션에 단일 액세스 지점(DNS)을 노출
  - 다운스트림 인스턴스의 장애를 원활히 처리할 수 있음
  - 인스턴스의 상태를 확인할 수 있음 (상태 확인 매커니즘으로 어떤 인스턴스로 트래픽을 보낼 수 없는지 확인해 줌)
  - 웹 사이트에 암호화된 HTTPS 트래픽을 가질 수 있음
  - 쿠키로 고정도를 강화할 수 있음
  - 영역에 걸친 고가용성을 가짐
  - 클라우드 내에서 개인 트래픽과 공공 트래픽을 분리할 수 있음
  - 관리형 로드 밸런서(managed load balancer)
    - AWS가 관리하며, 어떤 경우에도 작동할 것을 보장
    - AWS가 업그레이드와 유지 관리 및 고가용성을 책임짐
    - 로드 밸런서의 작동 방식을 수정할 수 있게끔 일부 구성 놉도 제공

  - 자체 로드 밸런서를 마련하는 것보다 저렴하고 자체 로드 밸런서를 직접 관리하려면 확장성 측면에서 굉장히 번거로움 
  - 다수의 AWS 서비스들과 통합되어 있음
    - EC2, EC2 오토 스케일링 그룹, Amazon ECS
    - AWS Certificate Manager (ACM), CloudWatch
    - Route 53, AWS WAF, AWS Global Accelerator

- 상태 확인(Health Checks)

  - ELB가 EC2 인스턴스의 작동이 올바르게 되고 있는지의 여부를 확인하기 위해 사용
  - ELB에겐 상태확인이 아주 중요 
  - 상태확인은 포트와 라우트에서 이루어짐
  - 만약 200응답을 받지 못하면, 인스턴스 상태가 좋지 않다고 기록됨 => 그쪽으로 트래픽을 보내지 않음

- AWS의 로드 밸런서 타입

  - 클래식 로드 밸런서  (v1 - old generation) (2009,  CLB)
    - HTTP, HTTPS, TCP, SSL (secure TCP) 지원
    - 콘솔에서는 더 이상 사용할 수 없음 => 시험에도 안나옴
  - 어플리케이션 로드 밸런서 (v2 - new generation) (2016, ALB)
    - HTTP, HTTPS, WebSocket
  - 네트워크 로드 밸런서 (v2 - new generation) (2017, NLB)
    - TCP, TLS, secure TCP, UDP
  - 게이트웨이 로드 밸런서 (2020, GWLB)
    - 네트워크층(3계층)에서 작동 - IP 프로토콜
  - 더 많은 기능을 가지고 있는 신형 로드 밸런서 사용을 권장
  - 네트워크에 개인적 접근이 가능한 내부 프라이빗 로드 밸런서가 있음
  - 웹사이트와 공공 애플리케이션 모두에 사용 가능한 외부 공공 로드 밸런서가 있음

- 로드 밸런서 보안 그룹 (Load Balancer Security Groups)

  - 유저는  HTTPS / HTTP를 사용해 어디서든 로드 밸런서의 접근이 가능
  - EC2 인스턴스는 로드 밸런서를 통해 곧장 들어오는 트래픽만을 허용해야 하기 때문에 소스는 로드 밸런서의 보안 그룹이 됨

  

### Application Load Balancer (ALB) 

- 애플리케이션 로드 밸런서
  - 7계층, 즉 HTTP 전용 로드 밸런서
  - 머신 간 다수 HTTP 애플리케이션의 라우팅에 사용 됨 (target groups)
  - 동일 EC2 인스턴스 상의 여러 애플리케이션에 부하를 분산함
  - HTTP/2 와  WebSocket을 지원
  - 리다이렉트도 지원 (ex: http -> https)
  - 다른 대상 그룹에 따른 라우팅
    - URL 대상 경로에 기반한 라우팅 (example.com/users & example.com/posts)
    - URL의 호스트 이름에 기반한 라우팅 (one.example.com & other.example.com)
    - 쿼리 문자열과 헤더에 기반한 라우팅 (example.com/users?id=123&order=false)
  - ALB는 마이크로 서비스나 컨테이너 기반 애플리케이션에 가장 좋은 로드 밸런서 (ex: Docker & Amazon ECS)
  - 포트 매핑 기능이 있어 ECS 인스턴스의 동적 포트로의 리다이렉션을 가능하게 해줌
  - 하나의 ALB로 다수의 애플리케이션을 처리할 수 있음
- ALB 대상 그룹 (Target Groups)
  - 종류
    - EC2 인스턴스 (오토 스케일링 그룹에 의해 관리될 수 있는) - HTTP
    - ECS 작업(Tasks) - HTTP
    - 람다 함수 - JSON 이벤트로 변환되는 HTTP 요청
    - IP 주소 - 사설 IP 주소만 가능
  - ALB는 여러 대상 그룹으로 라우팅할 수 있음
  - 상태 확인은 대상 그룹 레벨에서 이뤄짐
- 알아두면 좋은 내용
  - 고정 호스트 이름이 부여됨 (XXX.region.elb.amazonaws.com)
  - 애플리케이션 서버는 클라이언트의  IP를 직접 보지 못함
    - 클라이언트의 실제 IP는 X-Forwarded-For라고 불리는 헤더에 삽입
    - X-Forwarded-Port를 사용하는 포트와 X-Forwarded-Proto에 의해 사용되는 프로토콜도 얻게 됨



### Network Load Balancer (NLB) 

- 네트워크 로드 밸런서

  - 4계층(네트워크) 로드 밸런서이므로 TCP & UDP 트래픽을 다룰 수 있음
  - 초당 수백만 건의 요청을 처리할 수 있음
  - ~100ms로 짧은 지연시간을 가짐 (vs 400ms for ALB)
  - **가용 영역별로 하나의 고정 IP를 가짐**
    - 탄력적 IP 주소를 각 AZ에 할당할 수 있음
    - 여러 개의 고정 IP를 가진 애플리케이션을 노출할 때 유용
  - 고성능, TCP, UDP, 정적 IP 에 사용됨
  - AWS 프리티어에 포함 X

- 대상 그룹

  - EC2 인스턴스: TCP 또는 UDP 트래픽을 EC2 인스턴스로 리다이렉트 할 수 있음
  - IP 주소: 사설 IP 주소만 가능
  - 어플리케이션 로드 밸런서: 고정 IP 주소를 얻을 수 있고 HTTP 유형의 트래픽을 처리하는 규칙을 얻을 수 있음
  - 상태 확인 지원: TCP, HTTP, HTTPS 

  

### Gateway Load Balancer (GWLB)

- 게이트웨이 로드밸런서
  - 배포 및 확장과 AWS의 타사 네트워크 가상 어플라이언스의 플릿 관리에 사용
  - 예시: 방화벽, 침입 탐지 및 방지 시스템(IDPS), 심층 패킷 분석 시스템
  - 3계층(네트워크 계층) - IP Packets
  - 기능
    - 투명 네트워크 게이트웨이(Transparent Network Gateway): VCP의 모든 트래픽이 GWLB가 되는 단일 엔트리와 출구를 통과
    - 로드 밸런서: 대상 그룹의 가상 어플라이언스 집합에 전반적으로 트래픽을 분산
  - **6081번 포트의 GENEVE 프로토콜을 사용**
- 대상 그룹
  - EC2 인스턴스
  - IP 주소: 사설 주소만 가능



### Elastic Load Balancer - 고정 세션(Sticky Session)

- 고정 세션 (세션 밀접성 -  Session Affinity)
  - 고정성 혹은 고정 세션을 실행하는 것으로 로드 밸런서에 2가지 요청을 수행하는 클라이언트가 요청에 응답하기 위해 백엔드에 동일한 인스턴스를 갖는 것
  - 이 동작은 ALB에서도 설정할 수 있음
  - 고정성을 위해 사용되는 쿠키는 사용자가 컨트롤 가능한 만료 기간을 가지고 있음
  - 사용자의 로그인과 같은 중요한 정보를 취하는 세션 데이터를 잃지 않기 위해 사용
  - 고정성을 활성화하면 백엔드 EC2 인스턴스 부하에 불균형을 초래할 수 있음
- 쿠키
  - 애플리케이션 기반 쿠키 (Application-based Cookies) => 기간 설정 가능
    - 사용자 정의 쿠키
      - 대상(target)에 의해 생성
      - 애플리케이션에 필요한 모든 사용자 정의 속성을 포함할 수 있음
      - 쿠키 이름은 각 대상 그룹별로 개별적으로 지정해야 함
      - 쿠키 이름으로 AWSALB, AWSALBAPP, AWSALBTG는 사용하면 안됨 (ELB에서 사용하기 때문)
    - 애플리케이션 쿠키
      - 로드 밸런서에 의해 생성
      - 쿠키 이름은 AWSALBAPP
  - 기간 기반 쿠키 (Duration-based Cookies) => 기간 설정 불가
    - 로드 밸런서에서 생성되는 쿠키
    - ALB에서는 이름이 AWSALB이며 CLB에서는 AWSELB



### Elastic Load Balancer - 크로스존 로드밸런싱 (Cross Zone Load Balancing)

- 크로스존 로드 밸런싱
  - 각 로드 밸런서 인스턴서는 모든 가용영역에 등록된 모든 인스턴스에 전반적으로 동일하게 트래픽을 분산해줌
- 애플리케이션 로드 밸런서
  - 교차 영역 로드 밸런싱이 기본적으로 활성화 (대상 그룹 설정에서 비활성화 가능)
  - 데이터를 다른 가용 영역으로 옮기는데 비용이 들지 않음
- 네트워크 & 게이트웨이 로드 밸런서
  - 교차 영역 로드 밸런싱이 기본적으로 비활성화
  - 활성화하려면 비용을 지불해야 함 => 가용 영역 사이에서 데이터를 옮기면 비용이 듬



### Elastic Load Balancer - SSL 인증서

- SSL / TLS 기초
  - SSL
    - SSL 인증서는 클라이언트와 로드밸런서 사이에서 트래픽이 이동하는 동안 데이터를 암호화 해줌 
    - 이를 전송 중(in -flight) 암호화라고 함
    - 데이터는 네트워크를 이동하는 동안에는 암호화되고, 송신자와 수신자 측에서만 이를 복호화할 수 있음
    - SSL은 보안 소켓 계층(Secure Sockets Layer)을 의미하고 연결을 암호화하는 데 사용
  - TLS
    - 새로운 버전의 SSL로 전송 계층 보안(Transport Layer Security)을 의미
    - 최근에는 TLS 인증서가 주로 사용되는데 사람들은 여전히 이를  SSL이라고 부르고 있음
  - 퍼블릭 SSL 인증서는 인증기관(CA - Certificate Authorities)에서 발급
    - 인증기관: Comodo, Symantec, GoDaddy, GlobalSign, Digicert, Letsencrypt, etc...
    - 퍼블릭 SSL 인증서를 로드 밸런서에 추가하면, 클라이언트와 로드 밸런서 사이의 연결을 암호화할 수 있음
  - SSL 인증서에는 만료 날짜가 있어서 주기적으로 갱신해 인증 상태를 유지해줘야 함
- 로드 밸런서 - SSL 인증서
  - 사용자가 HTTPS를 통해 로드밸런서에 접속
  - 로드 밸런서에서는 내부적으로 SSL 종료(SSL Termination)를 수행
  - 백엔드에서는 HTTP로 EC2 인스턴스와 통신 (암호화 되지 않은 상태) -> VPC로 이동하는 트래픽은 프라이빗 네트워크를 쓰기 때문에 안전하게 보호
  - 로드 밸런서는 X.509 인증서를 사용 (SSL/TLS 서버 인증서로 불림)
  - AWS에는 이 인증서들을 관리할 수 있는 ACM(AWS Certificate Manager)이 있음
  - 본인의 인증서를 ACM에 업로드할 수도 있음
  - HTTP listener를 구성할 때 반드시 HTTPS listener 로 해야함
    - 기본 인증서를 지정해줘야 함
    - 다중 도메인을 지원하기 위해 다른 인증서를 추가할 수도 있음
    - 클라이언트는 SNI(Server Name Indication - 서버 이름 지정)라는 걸 써서 접속할 호스트의 이름을 알릴 수 있음
    - 원하는 대로 보안 정책을 지정할 수 있음 => 구 버전의  SSL과 TLS(레거시 클라이언트)를 지원
- SSL - Server Name Indication(SNI)
  - 여러 개의 SSL 인증서를 하나의 웹서버에 로드해 하나의 웹 서버가 여러 개의 웹 사이트를 지원할 수 있게 해줌
  - 확장된 프로토콜로, 최초 SLL 핸드셰이크 단계에서 클라이언트가 대상 서버의 호스트 이름을 지정하도록 함
  - 클라이언트가 접속할 웹사이트를 말했을 때, 서버는 어떤 인증서를 로드해야 하는지 알 수 있음
  - **ALB 와 NLB, CloudFront에 한해서만 동작함**
- SSL 인증서 지원 항목
  - 클래식 로드 밸런서 (v1)
    - 하나의  SSL 인증서만 둘 수 있음
    - 여러 개의 인증서로 여러 호스트 이름을 지원하려면 클래식 로드 밸런서를 여러 개 둬야 함
  - 애플리케이션 노드 밸런서 / 네트워크 로드 밸런서 (v2)
    - 여러 개의 SSL 인증서를 두고 리스너를 여러 개 지원할 수 있음
    - 멀티 지원을 위해 SNI를 사용



### Elastic Load Balancer (ELB) - 연결 드레이닝(Connection Draining)

- 연결 드레이닝
  - 명명법
    - CLB: 연결 드레이닝(Connection Draining)
    - ALB & NLB: 등록 취소 지연(Deregistration Delay)
  - 인스턴스가 등록 취소, 혹은 비정상인 상태에 있을 때 인스턴스에 어느 정도의 시간을 주어 인-플라이트 요청(활성 요철)을 완료할 수 있도록 하는 기능
  - EBL는 등록 취소 중인 EC2 인스턴스로 새로운 요청을 보내지 않음
  - 연결 드레이닝 파라미터: 1~3600s (default: 300s)
  - 파라미터를 0으로 설정하면 드레이닝이 비활성화 됨
  - 짧은 요청의 경우에는 낮은 값으로 설정하면 좋음



### Auto Scaling Group(ASG) 개요

- 오토 스케일링 그룹

  - 웹사이트나 애플리케이션 배포시에, 웹사이트 방문자가 갈수록 많아지면서 로드가 바뀔 수 있음

  - 클라우드에서 서버를 빠르게 생성하고 종료할 수 있음
    - ASG의 목표
      - 증가한 로드에 맞춰 스케일 아웃 (EC2 인스턴스 추가)
      - 감소한 로드에 맞춰 스케일 인 (EC2 인스턴스 제거)
      - ASG에서 실행되는 EC2 인스턴스의 최소 및 최대 개수를 정의 가능
      - 로드 밸런서와 페어링 하는 경우 ASG에 속한 모든 EC2 인스턴스가 로드 밸런서에 연결
      - 한 인스턴스가 비정상이면 종료하고 이를 대체할 새 EC2 인스턴스를 생성

  - ASG는 무료 (EC2 인스턴스와 같은 생성된 하위 리소스에 대한 비용만 내면 됨)

- 오토 스케일링 그룹 속성
  - 시작 템플릿(Launch Template) 생성
    - AMI 및 인스턴스 유형
    - EC2 사용자 데이터
    - EBS 볼륨
    - 보안 그룹
    - SSH 키 페어
    - EC2 인스턴스의 IAM 역할
    - 네트워크 및 서브넷 정보
    - 로드 밸런서 정보
  - 최소 크기 / 최대 크기 / 초기 용량 정의
  - 스케일링 정책 정의
- 오토 스케일링 - CloudWatch Alarms & Scaling
  - CloudWatch 알람을 기반으로 ASG를 스케일 인 및 스케일 아웃할 수 있음
  - 알람은 지표(metric)을 모니터링 함(평균 CPU, 원하는 사용자 지표)
  - 알람을 기반으로
    - 스케일 아웃 정책을 만들 수 있음 (인스턴스 수 증가)
    - 스케일 인 정책을 만들 수 있음 (인스턴스 수 감소)



### Auto Scaling Group(ASG) - 스케일링 정책(Scaling Polices)

- 동적 스케일링 정책 (Dynamic Scaling Polices)

  - 대상 추적 스케일링 (Target Tracking Scaling)
    - 가장 단순하고 설정하기 쉬움
    - Ex: 모든 EC2 인스턴스에서 오토 스케일링 그룹의 평균 CPU 사용률을 추적하여 이 수치가 40%대에 머무를 수 있도록 할 때 사용
  - 단순 / 단계 스케일링 (Simple / Step Scaling)
    - CloudWatch 경보를 설정(ex: CPU 70% 초과)하고 경보가 트리거 되면 용량을 두 유닛 추가하도록 설정 가능
    - CloudWatch 경보를 설정(ex: CPU 30% 미만)하고 경보가 트리거 되면 용량을 한 유닛 제거하도록 설정 추가 가능

- 예약된 작업 (Scheduled Actions)

  - 나와 있는 사용 패턴을 바탕으로 스케일링을 예상

  - Ex: 금요일 오후 5시에 큰 이벤트가 예정되어 있으니 매주 금요일 오후 5시마다 자동으로 ASG 최소 용량을 10까지 증가

- 예측 스케일링 (Predictive Scaling)

  - 로드를 보고서 다음 스케일링을 예측

- 스케일링을 예측하기 좋은 지표

  - CPU 사용률 (CPU Utilization): 모든 인스턴스의 평균 CPU 사용률
  - 대상별 요청의 수 (Request Count Per Target): 각 EC2 인스턴스에 인스턴스가 안정적일 수 있는 최대 요청수를 정함
  - 평균 네트워크 I / O (Average Network In / Out): 애플리케이션이 네트워크와 연결된 경우
  - 커스텀 지표: CloudWatch에서 애플리케이션 별로 지표 설정하고 이를 기반으로 스케일링 정책을 바꿀 수 있음

- 스케일링 휴지 (Scaling Cooldowns)

  - 스케일링 작업이 끝날 때마다 인스턴스의 추가 또는 삭제를 막론하고 휴지 기간(default 300초)을 갖는 것
  - 휴지 기간에는 ASG가 추가 인스턴스를 실행 또는 종료할 수 없음 => 지표를 이용하여 새로운 인스턴스가 안정화 될 수 있도록 해줌
  - 즉시 사용이 가능한 AMI를 이용하여 EC2 인스턴스 구성 시간을 단축하고 이를 통해 요청을 좀 더 신속히 처리하는 것이 좋음 => 활성화 시간이 빨라지면 휴지 기간 또한 단축되기 때문에 ASG 상에서 더 많은 동적 스케일링이 가능해짐



## Section 09. AWS 기초: RDS + Aurora + ElasticCache

### Amazon RDS 개요

- RDS
  - 관계형 데이터베이스 서비스(Relational Database Service)
  - SQL을 쿼리 언어로 사용하는 데이터베이스용 관리형 데이터베이스 서비스
  - 클라우드의 RDS 서비스에 DB를 생성할 수 있고 AWS가 DB를 관리
    - Postgres
    - MySQL
    - MariaDB
    - Oracle
    - Microsoft SQL Server
    - Aurora (AWS Proprietary database)
- RDS가 주는 이점
  - 관리형 서비스
    - 데이터베이스 프로비저닝, 기본 운영체제 패치 자동화
    - 지속적으로 백업이 생성되므로 특정 타임스탬프(특정 시점)으로 복원 가능
    - 대시보드에서 모니터링 가능
    - 읽기 전용 복제본을 활용해 읽기 성능을 개선할 수 있음
    - 재해 복구 (Disaster Recovery - DR)를 위해 다중 AZ 설정 가능 
    - 유지 관리 기간에 업그레이드 가능
    - 인스턴스 유형을 늘려 수직 확장하거나 읽기 전용 복제본을 추가하여 수평 확장 가능
    - 파일 스토리지는 EBS에 구성 (gp2 or io1)
  - RDS 인스턴스에 SSH 액세스를 할 수 없음
- RDS 스토리지 오토 스케일링
  - RDS DB 인스턴스는 동적으로 스토리지를 확장해줌
  - 데이터베이스 스토리지를 수동으로 확장하는 작업을 피할 수 있게해줌
  - **최대 스토리지 임계값(Maximum Storage Threshold) 를 설정해야 함**
  -  자동 수정 조건
    - 허용된 공간에서 남은 공간이 10% 미만이 되는 경우
    - 스토리지 부족 상태가 5분 이상 지속되는 경우
    - 지난 수정으로부터 6시간이 지났을 경우
  - 워크로드를 예측할 수 없는 애플리케이션에서 굉장히 유용
  - 모든 RDS 데이터베이스 엔진에서 지원되는 기능



### RDS 읽기 전용 복제본(Read Replicas for read scalability)과 다중 AZ

- RDS 읽기 전용 복제본
  - 읽기를 스케일링
  - 최대 15개까지 생성 가능
  - 가용영역 안, 가용 영역이나 리전을 걸쳐서 생성 가능
  - 복제는 ASYNC(비동기)이므로 읽기가 항상 일관적으로 유지됨
  - 복제본은 데이터베이스로 승격시켜 이용할 수도 있음
  - 읽기 전용 복제본을 활용하려면 애플리케이션이 연결을 업데이트해야 함
- 사용 사례
  - 평균적인 로드를 감당하고 있는 프로덕션 데이터베이스
  - 데이터를 기반으로 몇 가지 보고와 분석을 하기를 원함
  - 보고 애플리케이션을 메인 RDS DB 인스턴스에 연결하면 오버로드가 발생하고 생산 애플리케이션의 속도가 느려짐
  - 새로운 워크로드에 대한 읽기 전용 복제본을 생성
  - 이 경우 생산 애플리케이션을 전혀 영향을 받지 않음
  - 읽기 전용 복제본은 SELECT 명령문에만 사용
- 네트워크 비용
  - 보통 AWS에서는 하나의 가용 영역에서 다른 가용 영역으로 데이터가 이동할 때 비용이 발생
  - RDS에서는 읽기 전용 복제본이 다른 AZ이지만 동일한 리전 내에 있을 때는 비용이 발생하지 않음 => 다른 리전인 경우는 비용 발생
- RDS 다중 AZ (Disaster Recovery)
  - 다중 AZ는 주로 재해 복구에 사용됨
  - SYNC 복제본
  - 하나의 DNS 이름을 가짐 => 마스터에 문제가 생길 때 스탠바이 데이터베이스에 자동으로 장애 조치가 수행됨
  - 가용성을 높일 수 있음
  - 전체 AZ 또는 네트워크가 손실될 때, 마스터 인스턴스 또는 스토리지에 장애가 발생할 때에 대비한 장애 조치
  - 따로 앱에 수동으로 조치를 취할 필요가 없음
  - 스케일링에 이용되지 않음 => 스탠바이 데이터베이스는 단지 대기 목적 하나만 수행
  - 읽기 전용 복제본을 다중 AZ로도 설정할 수 있음
- 단일 AZ => 다중 AZ 전환
  - 이 작업에는 다운타임이 전혀 없음 (=DB를 중지할 필요가 없음)
  - 데이터베이스 수정을 클릭하고 다중 AZ 기능을 활성화시키기만 하면 됨
  - 내부적으로 발생하는 일
    - 기본 데이터베이스의 RDS가 자동으로 스냅샷을 생성
    - 이 스냅샷은 새로운 스탠바이 데이터베이스에 복원
    - 스탠바이 데이터베이스가 복원되면 두 데이터베이스 간 동기화(SYNC)가 설정됨



### RDS Custom for Oracle과 Microsoft SQL Server

- RDS Custom
  - RDS Custom을 사용해서 Oracle 및 Microsoft SQL Server에서 OS 및 데이터베이스 사용자 지정 기능에 액세스할 수 있음
  - RDS: AWS에서의 데이터베이스 자동화 설정, 운영, 스케일링
  - Custom: 기저 데이터베이스와 운영 체제에 액세스할 수 있게 됨
    - 내부 설정 구성
    - 패치 적용
    - 네이티브 기능 활성화
    - SSH 또는 SSM 세션 관리자를 사용해서 RDS 뒤에 있는 기저 EC2 인스턴스에 액세스 가능
  - 사용자 지정 설정을 사용하려면 RDS가 수시로 자동화, 유지 관리 또는 스케일링과 같은 작업을 수행하지 않도록 **자동화를 꺼두는 것이 좋음**
  - 오류 발생 가능성이 올라가므로 데이터베이스 스냅샷을 만들어 두는 것이 좋음
  - RDS vs RDS Custom
    - RDS: 전체 데이터베이스와 OS가 AWS에 의해 관리됨
    - RDS Custom: Oracle 및 Microsoft SQL Server에서만 사용할 수 있으며 관리자 권한 전체를 갖게 됨



### Amazon Aurora 개요

- Aurora
  - AWS 고유의 기술 (오픈 소스 X)
  - Postgres 및 MySQL과 호환되도록 만들어짐
  - 클라우드에 최적화되어 있어 RDS의 MySQL보다 5배, RDS의 Postgres보다 3배 높은 성능을 가짐
  - Aurora의 스토리지는 자동으로 확장 (10GB에서 시작하여 128TB까지 확장)
  - 읽기 전용 복제본의 경우 15개의 복제본을 둘 수 있으며 복제 속도도 훨씬 빠름 (MySQL은 최대 5개)
  - Aurora의 장애조치는 즉각적임 => 클라우드 네이티브이므로 가용성이 높음
  - RDS에 비해 약 20% 비용이 높음 => 스케일링 측면에서 훨씬 더 효율적
- 높은 가용성(High Availability)과 읽기 스케일링(Read Scaling)
  - 데이터베이스에 무언가를 기록할 때마다 3AZ에 걸쳐 6개의 사본을 저장함
    - 쓰기에는 6개 사본 중 4개만 있으면 됨
    - 읽기에는 6개 사본 중 3개만 있으면 됨
    - 자가 복구 과정이 있음
    - 단일 볼륨에 의존하지 않고 수 백 개의 볼륨을 사용
  - 쓰기를 받는 인스턴스는 하나 (master)
  - 마스터가 동작하지 않으면 평균 30초 이내로 장애 조치가 시작됨
  - 복제본들은 리전 간 복제를 지원
- Aurora DB Cluster
  - 라이터(Writer) 엔드포인트
    - 라이터 엔드포인트는 DNS 이름으로 항상 마스터를 가리킴
    - 장애 조치 후에도 클라이언트는 라이터 엔드포인트와 상호작용하게 됨 => 올바른 인스턴스로 자동으로 리다이렉트 됨
  - 리더(reader) 엔드포인트
    - 라이터 엔드포인트와 같은 역할
    - 연결 로드 밸런싱에 도움을 줌
    - 모든 읽기 전용 복제본과 자동으로 연결됨
    - **로드 밸런싱은 문장 레벨이 아닌 연결 레벨에서 일어남**
  - 공유 스토리지 볼륨
    - 자동 스케일링
    - 자동 확장
- Aurora의 기능
  - 자동 장애 조치
  - 백업 및 복구
  - 격리 및 보안
  - 산업 규정 준수
  - 버튼식 스케일링
  - 제로 다운타임 자동 패치 설치
  - 고급 모니터링
  - 통상 유지 관리
  - 백트랙: 과거 어떤 시점의 데이터로도 복원할 수 있게 해줌 (백업에 의존 X)

 

### Amazon Aurora - 고급 개념

- Aurora Replicas - Auto Scaling
  - 리더 엔드포엔트에서 많은 읽기 요청이 발생
  - Aurora DB의 CPU 사용량 증가
  - 복제본 오토 스케일링으로 인한 복제본 추가
  - 리더 엔드포인트가 새 복제본을 처리하도록 확장됨
  - 새로운 복제본은 트래픽을 받기 시작하고, 읽기가 더 분산된 방식으로 발생함
  - 전체 CPU 사용량이 낮아짐
- Aurora - 사용자 지정 엔드포인트 (Custom Endpoints)
  - Aurora 인스턴스의 하위 집합을 사용자 지정 엔드포인트로 정의
  - Example: 특정 복제본에 대해 분석 쿼리를 실행할 수 있음
  - 리더 엔드포인트는 일반적으로 사용자 지정 엔드포인트를 정의한 후에는 사용되지 않음
- Aurora Serverless
  - 실제 사용량에 따라 자동화된 데이터베이스 인스턴스화 및 오토 스케일링을 제공
  - 워크로드가 드물거나 간헐적이거나 예측할 수 없는 경우에 유용
  - 용량 계획을 세울 필요가 없음
  - 각 Aurora 인스턴스에 초당 요금을 지불하게 되므로 비용 효율적임
- Aurora 멀티 마스터(Multi-Master)
  - 라이터 노드에 대해 지속적인 쓰기 가용성을 원하는 경우
  - Aurora 클러스터에서 모든 Aurora 인스턴스는 라이터 노드가 됨
- Global Aurora
  - 리전 간 읽기 복제본이 있는 경우
    - 재해 복구에 매우 유용
    - 설치가 매우 간단
  - Aurora Global Database 설정 가능 (권장 됨)
    - 기본 리전에서 읽기 및 쓰기가 모두 일어남
    - 최대 5개의 보조 읽기 전용 리전도 있음 => 복제 지연이 1초 미만
    - 보조 리전당 최대 16개의 읽기 복제본을 설정할 수 있음
    - 읽기 워크로드 지연 시간을 줄일 수 있음
    - 재해 복구를 위해 다른 리전을 활성화할 때 복구 시간 목표 (RTO)를 1분 미만으로 할 수 있음
- Aurora Machine Learning
  - Aurora 머신러닝은 애플리케이션에 머신러닝 기반 예측을 적용할 수 있음
  - Aurora와 AWS ML 서비스 간의 간단하고 최적화된 안전한 통합
  - 지원되는 서비스
    - Amazon SageMaker (모든 종류의 머신러닝 모델을 사용할 수 있게 해줌)
    - Amazon Comprehend (감성 분석 가능)
  - 머신러닝 경험이 없어도 됨
  - 사용 사례: 사기 탐지, 광고 타겟팅, 감정 분석, 제품 추천 등



### RDS & Aurora - 백업과 모니터링

- RDS Backups
  - 자동화된 백업
    - 자동으로 매일 데이터베이스의 전체 백업을 수행 (데이터베이스 백업 기간 동안)
    - 5분마다 트랜잭션 로그가 백업 => 가장 빠른 백업은 5분 전의 백업
    - 자동 백업 보존 기간은 1~35일 사이로 설정 가능
    - 백업 보존 기간을 0으로 설정 시 자동 백업을 사용하지 않게 됨
  - 수동 DB 스냅샷 (Manual DB Snapshots)
    - 사용자가 수동으로 트리거
    - 수동으로 한 백업을 원하는 기간 동안 유지할 수 있음 (자동 백업은 만료 됨)
  - 스냅샷은 RDS 데이터베이스의 실제 스토리지 비용보다 훨씬 저렴하므로 DB를 지속적으로 사용하는게 아니라면 스냅샷을 뜬 뒤에 RDS 데이터베이스를 삭제하고 DB를 사용시에 스냅샷을 사용해 복원하면 비용을 절감할 수 있음

- Aurora Backups
  - 자동화된 백업
    - 1~35일 사이로 설정 가능 => 비활성화 불가
    - 시점 복구 기능 => 해당 기간의 어느 시점으로든 복구 가능
  - 수동 DB 스냅샷
    - 사용자가 수동으로 트리거
    - 수동으로 한 백업을 원하는 기간 동안 유지할 수 있음 (자동 백업은 만료 됨)
- RDS & Aurora 복원 옵션 (Restore options)
  - RDS 또는 Aurora의 백업 또는 스냅샷은 새 데이터베이스로 복원이 가능
  - S3에서 MySQL 데이터베이스를 복원이 가능
    - 온프레미스 데이터베이스의 백업을 생성
    - 객체 스토리지인 Amazon S3에 백업 파일 배치
    - MySQL을 실행하는 새 RDS 인스턴스로 백업 파일을 복원
  - S3에서 MySQL Aurora 클러스터로 복원이 가능
    - 온프레미스 데이터베이스를 다시 백업 (Percona XtraBackup 소프트웨어 사용)
    - 객체 스토리지인 Amazon S3에 백업 파일 배치
    - MySQL을 실행하는 새 Aurora 클러스터로 백업 파일을 복원
- Aurora Database Cloning
  - 기존 데이터베이스 클러스터에서 새로운 Aurora 데이터베이스 클러스터를 생성할 수 있음
  - 스냅샷을 찍고 복원하는 것보다 훨씬 빠름
  - copy-on-write 프로토콜을 사용
    - 처음 데이터베이스 복제본을 만들 때는, 원래 데이터베이스 클러스터와 동일한 데이터 볼륨을 사용하게 됨 (빠르고 효율적 => 데이터 복사 X)
    - 새로운 DB 클러스터 데이터에 업데이트가 이루어지면 새로운 추가 스토리지가 할당되고, 데이터가 복사 및 분리됨
  - 매우 빠르고 비용 효율적
  - 프로덕션 데이터베이스에 영향을 주지 않으면서 데이터베이스를 복제하는 데 매우 유용



### RDS Security

- RED & Aurora Security
  - 저장된 데이터 암호화 (At-rest encryption)
    - KMS를 사용해 마스터와 모든 복제본의 암호화가 이루어짐 (DB를 처음 실행할 때 정의됨)
    - 마스터 DB를 암호화하지 않았다면 읽기 전용 복제본을 암호화할 수 없음
    - 암호화 되어있지 않은 기존 DB를 암호화 하려면 암호화 되지 않은 DB의 DB 스냅샷을 가지고 와서 암호화된 DB 형태로 DB 스냅샷을 복원해야 함
  - 전송 중 데이터 암호화 (In-flight encryption)
    - RDS 및 Aurora의 각 DB는 기본적으로 전송 중 데이터 암호화 기능을 갖추고 있음
    - 클라이언트는 AWS 웹사이트에서 제공하는 AWS의 TLS 루트 인증서를 사용해야 함
  - IAM 인증 (IAM Authentication)
    - IAM 역할을 사용해서 데이터베이스에 접속이 가능 (username/pw 방식 대신)
  - 보안 그룹 (Security Groups)
    - 보안 그룹을 사용하여 DB에 대한 네트워크 액세스를 통제할 수 있음
    - 특정 포트, IP, 보안 그룹을 허용하거나 차단 가능
  - RDS와 Aurora에는 SSH 액세스가 없음 (RDS 커스텀 서비스는 예외)
  - DB 확인을 위해 감사 로그 작성(Audit Logs)을 활성화 할 수 있으며 로그를 장기간 보관하고 싶으면 CloudWatch Logs 전용 서비스로 전송해야 함



### RDS Proxy

- Amazon RDS Proxy
  - 완전 관리형 RDS 데이터베이스 프록시 (Fully managed database proxy for RDS)
  - Amazon RDS 프록시를 사용하면 애플리케이션이 데이터베이스 내에서 DB 연결 풀을 형성하고 공유할 수 있음
  - RDS 데이터베이스 인스턴스에 직접 연결을 줄여 CPU와 RAM 등 데이터베이스 리소스의 부담을 줄여 데이터베이스 효율성을 향상시킬 수 있고 데이터베이스에 개방된 연결과 시간초과를 최소화할 수 있음
  - 서버리스, 오토 스케일링 (용량 관리 X), 높은 가용성 (다중 AZ)
  - RDS & Aurora 장애조치 시간이 66%까지 감소
  - RDS (MySQL, PostgreSQL, MariaDB) 및 Aurora (MySQL, PostgreSQL) 지원
  - 애플리케이션 코드를 변경하지 않아도 됨
  - 데이터베이스에 IAM 인증을 강제함으로써 IAM 인증을 통해서만 RDS 데이터베이스 인스턴스에 연결하도록 할 수 있음 
    - 자격 증명은 AWS Secrets Manager 서비스에 안전하게 저장됨
  - RDS는 퍼블릭 엑세스가 절대로 불가능 (VPC 내에서만 액세스 가능) => 보안 훌륭



### ElastiCache 개요

- Amazone ElastiCache

  - RDS가 관계형 데이터베이스를 관리하는 것과 같은 방식
  - ElastiCache는 캐싱 기술인 Rdis 또는 Memcached를 관리할 수 있도록 도와줌
  - 캐시는 매우 높은 성능과 짧은 지연 시간을 가진 인메모리 데이터베이스
  - 읽기 집약적인 워크로드에서 데이터베이스의 로드를 줄여줌 => 일반적인 쿼리는 캐시에 저장되므로, 매번 데이터베이스를 쿼리하지 않아도 됨
  - 애플리케이션을 상태 비저장형(application stateless)으로 할 수 있게 도와줌
  - AWS는 데이터베이스의 운영 체제를 유지 관리할 수 있음
    - 패치, 최적화, 설정, 구성, 모니터링, 장애 복구, 백업
  - ElastiCache를 사용하는 경우, 애플리케이션의 코드를 많이 바꿔야함

-  ElastiCache Solution Architecture - DB Cache

  - 애플리케이션은 쿼리를 ElastiCache에 작성 => 쿼리가 이미 발생했는지 확인을 위함
  - 캐시 히트(ElastiCache에 해당 쿼리가 저장): 쿼리를 수행하기 위해 DB로 이동하는 시간이 절약
  - 캐시 미스: DB에서 데이터를 가지고 옴
  - RDS의 로드를 줄이는데 도움을 줌
  - 캐시 무효화 전략이 필요 => 가장 최신 데이터만 사용되어야하므로

- ElastiCache Solution Architecture - User Session Store

  - 사용자가 어떤 애플리케이션에 로그인
  - 애플리케이션이 세션 데이터를 Amzone ElastiCache에 작성
  - 사용자가 애플리케이션의 다른 인스턴스로 리디렉션되면 애플리케이션은 그 세션의 세션 캐시를  ElastiCache에서 직접 검색이 가능 => 사용자는 여전히 로그인 상태가 됨
  - 애플리케이션을 상태 비저장형으로 만듬

- ElastiCache - Redis vs Memcached

  - Redis

    - **다중 AZ**: 자동 장애 조치 기능
    - **읽기 복제본**: 읽기를 확장하고 **고가용성**을 가짐
    - AOF 지속성을 이용한 **데이터 내구성**
    - **백업 및 복원 기능**
    - 세트 및 정렬된 세트를 제공

  - Memcached

    - 데이터 분할을 위해 멀티 노드 사용 (샤딩<sup>sharding</sup>이라고 함)
    - **고가용성 없음** **(= 복제가 일어나지 않음)**
    - **영구적이지 않음**
    - **백업 및 복원 없음**

    - 멀티스레드 아키텍처



### 솔루션 설계자를 위한 한 ElastiCache

- Cache Security
  - Redis에서만 IAM 인증을 지원
  - ElastiCache에서 IAM 정책을 정의하면 AWS API 수준 보안에만 사용됨
  - Redis AUTH
    - Redis 클러스트를 만들 때, Redis 내 보안을 통해 비밀번호와 토큰을 설정할 수 있음
    - 캐시에 추가 보안 수준을 제공하는 것 (보안 그룹에 추가로)
    - SSL 전송 중 암호화 지원
  - Memcached
    - SASL 기반 승인을 제공
- ElasticCache을 로드하는 패턴
  - 지연 로딩 (Lazy Loading)
    - 모든 데이터가 캐시되고 데이터가 캐시에서 지체될 수 있음
  - Write Through
    - DB에 데이터가 기록될 때마다 캐시에 데이터를 추가하거나 업데이트
    - 데이터가 지체되지 않음
  - 세션 스토어 (Session Store)
    - 캐시에 임시 세션 데이터를 저장
    - 유지 시간 기능(TTL features)을 사용해 세션을 만료할 수 있음
  - 컴퓨터 과학에서 가장 어려운 것 두 가지는 캐싱 무효화와 이름 붙이기
- Redis 사용 사례
  - 게이밍 리더보드 만들기
  - Redis Sorted Sets는 고유성과 요소 순서를 모두 보장함
  - 요소가 추가될 때마다, 실시간으로 순위를 매긴 다음 올바른 순서로 추가됨





## Section 09. Route 53

### DNS

- DNS란?

  - DNS (Domain Name System):  사람에게 친숙한 호스트 이름을 대상 서버 IP 주소로 번역해 줌
  - ex: www.google.com => 172.217.18.36
  - DNS는 인터넷의 중추로 URL과 호스트 이름을 IP로 변환
  - DNS는 계층적 이름 구조가 있음

- DNS 관련 용어 (Terminologies)

  - 도메인 레지스트라 (Domain Registrar): 도메인 이름을 등록하는 곳 - Route 53, GoDaddy, ...
  - DNS 레코드 (DNS Records): A, AAAA, CNAME, NS, ...
  - 존 파일 (Zone File): 모든 DNS 레코드를 포함
  - 이름 서버 (Name Server): DNS 쿼리를 실제로 해결하는 서버
  - 최상위 도메인 (Top Level Domain - TLD): .com, .us, .in, .gov, .org, ...
  - 2단계 도메인 (Second Level Domain - SLD): amazon.com, google.com, ...
  - FQDN: 전체 주소 도메인 이름 (Fully Qualified Domain Name) 의 약자 => 프로토콜까지 포함된 이름

- DNS 동작 방법

  ![KakaoTalk_Photo_2023-10-15-19-40-28](/Users/iseongheon/Downloads/KakaoTalk_Photo_2023-10-15-19-40-28.jpeg)



### Route 53 개요







